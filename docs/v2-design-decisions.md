# A/B 테스트 계산기 v2 설계 의사결정

v2 개발 과정에서의 주요 설계 결정 및 배경

---

## 1. UI 개선안

### 1.1 입력 필드 정렬

**문제:** 입력 필드들의 오른쪽 끝이 불규칙하게 끝나 시각적으로 산만함

**해결:**
```html
<!-- 모든 입력 필드에 통일된 레이아웃 적용 -->
<div style="display: flex; gap: 8px; align-items: center;">
    <div class="input-with-unit" style="flex: 1;">
        <input ... >
        <span class="unit">단위</span>
    </div>
    <span>권장 표시 (있는 경우)</span>
</div>
```

**결과:** 모든 입력 필드의 오른쪽 끝이 깔끔하게 정렬됨

### 1.2 권장 표시 일관성

**결정:** 테스트 기간(7일)과 배분 비율(50:50) 모두 "⭐ 권장" 표시

**이유:**
- 시각적 일관성
- 권장 설정의 명확한 전달
- 사용자 의사결정 지원

### 1.3 중복 정보 제거

**문제:** 결과 영역에 테스트 기간을 다시 표시 (이미 입력한 값)

**결정:** 테스트 기간 결과 섹션 완전 제거

**이유:**
- 입력 필드에서 이미 실시간 피드백 제공
- 계산 기준 섹션에서 다시 확인 가능
- 불필요한 중복 제거

---

## 2. 전체 흐름 재설계

### 2.1 입력 흐름

```
1. 현재 지표 입력 (%)
   └─ 실시간 검증: 0~100 범위

2. 목표 개선 입력 (%)
   ├─ 프리셋 버튼: +5%, +10%, +20%
   └─ 실시간 예시: "3% → 3.30%"

3. 하루 방문수 입력 (명)
   └─ 실시간 피드백: 방문수가 적으면 안내

4. 테스트 기간 입력 (일) ⭐ 권장
   ├─ 기본값: 7일
   └─ 실시간 피드백: 기간별 권장사항

5. 배분 비율 선택 ⭐ 권장
   ├─ 기본값: 50:50
   ├─ 프리셋: 60:40, 70:30, 80:20
   └─ 커스텀 입력 가능

[고급 설정] (선택사항, 접기/펼치기)
├─ 유의수준 (Alpha): 0.05 기본
├─ 검정력 (Power): 0.80 기본
└─ 추정 계수 직접 입력: 자동 기본

[계산하기 버튼]
```

### 2.2 결과 표시 구조

**최종 구조:**
```
📊 필요 샘플
├─ 대조군 (A안): X명
├─ 실험군 (B안): Y명  
├─ 총 필요 샘플: Z명
└─ 배분 효율성: N%
    └─ "50:50 대비 1.2배 샘플 필요 (+20%)"

🎯 슬롯 할당
├─ 필요 슬롯: N개 (전체의 %)
├─ 대조군 슬롯: 1 ~ X
├─ 실험군 슬롯: X+1 ~ Y
└─ [슬롯 사용률 경고/안내]

💡 계산 기준
├─ 입력 정보
│   └─ 하루 방문: N명, 기간: M일
└─ 자동 추정
    ├─ M일 고유 유저: ~K명
    ├─ 추정 계수: 0.XX
    └─ 슬롯 1개당: 약 P명

[더 정확한 계산이 필요하신가요?] (접기/펼치기)
└─ SQL 쿼리 템플릿 제공
```

**제거된 항목:**
- ❌ 테스트 기간 결과 섹션 (중복)
- ❌ 슬롯 복사 버튼 (불필요)

---

## 3. 계산 로직

### 3.1 샘플 크기 계산

**Two-proportion Z-test 공식:**

```javascript
// 1. Z-score 설정 (고급 설정 반영)
z_alpha = alpha별 값 (0.05→1.96, 0.01→2.576, 0.10→1.645)
z_beta = power별 값 (0.80→0.84, 0.90→1.282, 0.70→0.524)

// 2. 비율 계산
p1 = baseline / 100
p2 = p1 × (1 + mde / 100)

// 3. 샘플 크기
n1 = (z_alpha + z_beta)² × (p1(1-p1) + p2(1-p2)/kappa) / (p2-p1)²
n2 = n1 × kappa
total = n1 + n2
```

**검증 완료:**
- ✅ Alpha 변경 시 Z-score 정확히 반영
- ✅ Power 변경 시 Z-score 정확히 반영
- ✅ 배분 비율 변경 시 kappa 정확히 계산

### 3.2 고유 유저 추정

**기간별 중복 제거 계수:**

```javascript
DEDUPLICATION_COEFFICIENT = {
    1: 1.00,   // 1일: 중복 없음
    3: 0.75,   // 3일: 75% 고유
    7: 0.60,   // 7일: 60% 고유 ⭐ 기본
    14: 0.50,  // 14일: 50% 고유
    21: 0.45,
    30: 0.40,
    60: 0.30
}
```

**보간 계산:**
```javascript
// 예: 10일 계수 계산
// 7일(0.60) ←→ 14일(0.50) 사이
ratio = (10 - 7) / (14 - 7) = 3/7 = 0.429
coefficient = 0.60 - (0.60 - 0.50) × 0.429 = 0.557
```

**우선순위:**
1. 수동 입력 계수 (사용자가 직접 입력한 경우)
2. 정확한 매칭 (1, 3, 7, 14일 등)
3. 선형 보간 (중간 값)
4. 범위 밖 처리 (최솟값/최댓값 사용)

**검증 완료:**
- ✅ 정확한 매칭 정상 작동
- ✅ 보간 계산 정상 작동  
- ✅ 수동 입력 우선 처리

### 3.3 슬롯 계산

**공식:**
```javascript
// 1. 고유 유저 추정
uniqueUsers = dailyVisitors × duration × coefficient

// 2. 슬롯당 유저 수
usersPerSlot = uniqueUsers / 10000

// 3. 필요 슬롯
requiredSlots = ceil(totalSamples / usersPerSlot)

// 4. 슬롯 범위
controlSlots = ceil(requiredSlots × controlRatio)
treatmentSlots = requiredSlots - controlSlots

대조군: 1 ~ controlSlots
실험군: (controlSlots + 1) ~ requiredSlots
```

**예시 (50:50 배분):**
```
필요 샘플: 10,000명
고유 유저: 420,000명 (10만/일 × 7일 × 0.60)
슬롯당: 42명 (420,000 / 10,000)
필요 슬롯: 239개 (10,000 / 42)
대조군: 1 ~ 120 (120개)
실험군: 121 ~ 239 (119개)
```

### 3.4 배분 효율성 계산

**올바른 공식:**
```javascript
treatmentPortion = treatmentRatio / (controlRatio + treatmentRatio)
relativeEfficiency = 4 × treatmentPortion × (1 - treatmentPortion)
```

**예시:**
```
50:50 → 4 × 0.5 × 0.5 = 1.00 (100%)
60:40 → 4 × 0.4 × 0.6 = 0.96 (96%)
80:20 → 4 × 0.2 × 0.8 = 0.64 (64%)
```

**안내 문구:**
```javascript
if (efficiency >= 99%) {
    "가장 효율적인 배분입니다"
} else {
    "50:50 대비 X배 샘플 필요 (+Y%)"
}
```

**수정 사항:**
- ❌ 기존: `min(controlRatio, treatmentRatio) × 2` (부정확)
- ✅ 수정: `4 × p × (1-p)` (정확)

---

## 4. 실시간 검증

### 4.1 입력 값 검증

**최소주의 접근:**
- **물리적 제약만 검증** (양수, 범위 내)
- **권장사항은 안내만** (차단하지 않음)
- **사용자 판단 존중**

**예시:**

```javascript
// ❌ 차단 (물리적 제약)
if (duration < 1) {
    "❌ 1일 이상 입력하세요"
}

// 💡 안내 (권장사항)
if (duration < 7) {
    "💡 7일 미만은 요일 효과가 남을 수 있습니다"
}
```

### 4.2 기간별 피드백

| 기간 | 피드백 | 차단 여부 |
|------|--------|----------|
| < 1일 | ❌ 1일 이상 입력하세요 | 차단 |
| 1~6일 | 💡 요일 효과가 남을 수 있습니다 | 안내 |
| 7일 | ✅ 최소 권장 기간입니다 | - |
| 14일+ | ✅ 충분한 기간입니다 | - |

### 4.3 방문수 피드백

| 방문수 | 피드백 | 차단 여부 |
|--------|--------|----------|
| < 1 | ❌ 1명 이상 입력하세요 | 차단 |
| < 1000 | 💡 방문수가 적어 기간이 길어질 수 있습니다 | 안내 |
| 1000+ | - | - |

### 4.4 슬롯 경고

**계산 후 표시:**

| 슬롯 사용률 | 메시지 | 색상 |
|------------|--------|------|
| > 10,000개 | ❌ 슬롯 초과 - 기간 늘리거나 MDE 줄이기 | 빨강 |
| > 50% | ⚠️ 슬롯 사용률 높음 - 병렬 실험 주의 | 주황 |
| 30~50% | 💡 슬롯 사용률 적정 | 파랑 |
| < 30% | ✅ 슬롯 사용률 효율적 | 초록 |

---

## 5. 플랫폼 기본 설정

### 5.1 CONFIG 구조

```javascript
const CONFIG = {
    // 기본값
    DEFAULTS: {
        DURATION: 7,           // 최소 권장 기간
        ALLOCATION: '50:50',   // 최고 효율 배분
        ALPHA: 0.05,          // 업계 표준
        POWER: 0.80,          // 적정 검정력
        TOTAL_SLOTS: 10000    // 플랫폼 제약
    },
    
    // 중복 제거 계수
    DEDUPLICATION_COEFFICIENT: {
        1: 1.00, 3: 0.75, 7: 0.60, 14: 0.50,
        21: 0.45, 30: 0.40, 60: 0.30
    },
    
    // 검증 임계값
    VALIDATION: {
        MIN_DURATION: 1,                    // 물리적 최소
        RECOMMENDED_DURATION: 7,            // 권장 최소
        MIN_VISITORS: 1,                    // 물리적 최소
        RECOMMENDED_MIN_VISITORS: 1000,     // 권장 최소
        SLOT_WARNING_THRESHOLD: 0.5         // 50% 이상 경고
    },
    
    // 배분 비율 옵션
    ALLOCATION_OPTIONS: {
        '50:50': { efficiency: 100, desc: '⭐ 가장 효율적' },
        '60:40': { efficiency: 96, desc: '균형잡힌 배분' },
        '70:30': { efficiency: 84, desc: '실험군 비중 낮춤' },
        '80:20': { efficiency: 64, desc: '🛡️ 리스크 최소화' }
    }
}
```

### 5.2 기본값 선정 근거

**테스트 기간: 7일**
- 요일 효과 제거 (최소 1주일)
- 실무 적용 가능성 (너무 길지 않음)
- 통계적 타당성과 실용성의 균형

**배분 비율: 50:50**
- 통계적으로 가장 효율적 (100%)
- 샘플 수 최소화
- 업계 표준

**유의수준: 0.05**
- 업계 표준 (95% 신뢰수준)
- Type I Error 5% 허용
- 학계/산업계 일반적 기준

**검정력: 0.80**
- 업계 표준 (80% 검출력)
- Type II Error 20% 허용
- 실용적인 균형점

### 5.3 슬롯 시스템

**설계:**
- 총 슬롯: 10,000개 (0~9,999)
- 할당 방식: `hash(device_id) % 10000`
- 특징: 결정적(deterministic), 균등 분포

**장점:**
- 동일 사용자 항상 같은 슬롯
- 여러 실험 병렬 실행 가능
- 슬롯 관리 단순

**제약:**
- 슬롯 재사용 불가 (동시 실험 제약)
- 10,000개 한도

---

## 6. 주요 기술 결정

### 6.1 단일 파일 구조

**결정:** 모든 코드를 하나의 HTML 파일에 포함

**이유:**
- 배포 단순화 (GitHub Pages 직접 호스팅)
- 외부 의존성 없음
- 오프라인 사용 가능
- 버전 관리 명확

### 6.2 Vanilla JavaScript

**결정:** 프레임워크 없이 순수 JS 사용

**이유:**
- 단순한 도구에 적합
- 빠른 로딩 속도
- 추가 빌드 과정 불필요
- 유지보수 용이

### 6.3 반응형 디자인

**결정:** 모바일 친화적 UI

**이유:**
- PM들이 다양한 환경에서 사용
- CSS Flexbox 기반 레이아웃
- 최소 너비 320px 지원

---

## 7. 개선 포인트

### 7.1 사용자 경험

**개선 전:**
- 복잡한 통계 용어
- 불명확한 결과 의미
- 실험 플랫폼 연동 수동

**개선 후:**
- PM 친화적 용어로 변경
- 직관적인 안내 문구
- 슬롯 자동 계산 및 할당

### 7.2 계산 정확도

**개선 전:**
- DAU × 기간으로 단순 계산
- 중복 유저 미고려
- 배분 효율성 계산 오류

**개선 후:**
- 기간별 중복 제거 계수 반영
- 고유 유저 정확 추정
- 배분 효율성 정확 계산

### 7.3 유연성

**개선 전:**
- 고정된 통계 파라미터
- 단일 배분 비율

**개선 후:**
- 고급 설정으로 커스터마이징
- 다양한 배분 비율 지원
- 수동 계수 입력 가능

---

## 8. 향후 고려사항

### 8.1 단기 개선
- [ ] 계산 결과 히스토리 저장
- [ ] 다양한 지표 타입 지원 (평균, 합계)
- [ ] 계산 결과 내보내기 (CSV, PDF)

### 8.2 중장기 개선
- [ ] 다중 실험 간섭 분석
- [ ] Sequential testing 지원
- [ ] Bayesian A/B testing 옵션

### 8.3 확장성
- [ ] API 제공 (다른 도구 연동)
- [ ] 실험 플랫폼 직접 연동
- [ ] 팀별 설정 프리셋 저장

---

## 9. 결론

v2는 단순한 계산기를 넘어 **실무 친화적인 실험 설계 도구**로 진화했습니다.

**핵심 가치:**
1. **정확성**: 통계적으로 정확한 계산
2. **실용성**: 실제 플랫폼 제약 반영
3. **접근성**: PM 누구나 쉽게 사용
4. **투명성**: 계산 과정 명확히 공개

v2는 PM들이 A/B 테스트를 더 자신있게 설계하고 실행할 수 있도록 돕습니다.
