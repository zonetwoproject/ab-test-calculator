<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A/B ÌÖåÏä§Ìä∏ Í≥ÑÏÇ∞Í∏∞ Mark9</title>
    <link rel="icon" type="image/svg+xml" href="/versions/v9/assets/favicon-ab.svg">
    <style>
        :root {
            --bg-page: #f7faff;
            --bg-panel: #ffffff;
            --line: #e3eaf4;
            --text-main: #111827;
            --text-sub: #6b7280;
            --blue-1: #2f83ef;
            --blue-2: #1e64d7;
            --blue-3: #1a5fcf;
            --mint-text: #0f9968;
            --radius-xl: 16px;
            --radius-lg: 14px;
            --radius-md: 12px;
            --card-shadow: 0 2px 8px rgba(36, 80, 149, 0.06);
            --fs-body: 13.5px;
            --fs-title: 22px;
            --fs-version: 12px;
            --fs-label: 12px;
            --fs-step: 14.5px;
            --fs-input: 13.5px;
            --fs-help: 11.5px;
            --fs-unit: 13px;
            --fs-btn: 13.5px;
            --badge-size: 24px;
            --badge-fs: 15px;
            --control-h: 38px;
            --row-gap: 14px;
            --space-1: 4px;
            --space-2: 6px;
            --space-3: 8px;
            --space-4: 10px;
            --space-5: 12px;
            --space-6: 14px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            width: 100%;
            max-width: 100%;
        }

        body {
            font-family: "Pretendard Variable", "Pretendard", "Noto Sans KR", "Apple SD Gothic Neo", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: linear-gradient(180deg, #fbfdff 0%, var(--bg-page) 100%);
            color: var(--text-main);
            min-height: 100vh;
            padding: clamp(8px, 2.5vw, 14px);
            padding-bottom: calc(clamp(12px, 3vw, 18px) + env(safe-area-inset-bottom));
            font-size: var(--fs-body);
            line-height: 1.5;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 860px;
            margin: 0 auto;
            border-radius: 0;
            overflow: visible;
            border: none;
            background: transparent;
            box-shadow: none;
        }

        .header {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 8px 8px 10px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .title-line {
            display: flex;
            align-items: baseline;
            gap: var(--space-2);
        }

        .drag-icon {
            display: none;
        }

        .header h1 {
            font-size: 15px;
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -0.2px;
            color: #111827;
        }

        .version-badge {
            font-size: 10px;
            font-weight: 700;
            line-height: 1.2;
            color: #2f83ef;
            background: #e8f0ff;
            border-radius: 6px;
            padding: 2px 8px;
        }

        .content {
            padding: 0;
            background: transparent;
            width: 100%;
        }

        .content-inner {
            max-width: 100%;
            margin: 0 auto;
            width: 100%;
        }

        #calculator-form {
            display: flex;
            flex-direction: column;
            gap: clamp(14px, 3.6vw, 22px);
            margin-bottom: var(--space-5);
        }

        .guide-box {
            background: #f5f9ff;
            border: 1px solid #dde7f7;
            border-radius: 14px;
            padding: 12px 14px;
            color: #5d6d86;
            line-height: 1.5;
            font-size: var(--fs-help);
        }

        .guide-box ol {
            margin-left: 15px;
            display: grid;
            gap: var(--space-1);
        }

        .settings-card {
            background: var(--bg-panel);
            border: 1px solid var(--line);
            border-radius: clamp(16px, 4vw, 22px);
            padding: clamp(14px, 4.6vw, 22px) clamp(12px, 4vw, 18px);
            box-shadow: var(--card-shadow);
            max-width: 100%;
        }

        .card-header {
            margin-bottom: 14px;
        }

        .card-title {
            font-size: calc(var(--fs-step) + 6px);
            font-weight: 900;
            color: #1d2433;
            letter-spacing: -0.015em;
            line-height: 1.2;
        }

        .card-subtitle {
            margin-top: 4px;
            font-size: calc(var(--fs-help) + 2px);
            color: #9aa3b2;
            font-weight: 600;
        }

        .step-block {
            padding-bottom: 0;
            border-bottom: none;
        }

        .section-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--row-gap);
            padding-bottom: 0;
            border-bottom: none;
            align-items: start;
        }

        .section-row .form-group {
            margin-bottom: 0;
        }

        .section-row .step-block {
            padding-bottom: 0;
            border-bottom: none;
        }

        .form-group {
            margin-bottom: 8px;
            display: flex;
            flex-direction: column;
            gap: 9px;
            min-width: 0;
        }

        label {
            display: block;
            margin-bottom: 0;
            color: var(--text-main);
            font-size: var(--fs-label);
            font-weight: 700;
        }

        .step-label {
            display: block;
            font-size: var(--fs-step);
            font-weight: 800;
            letter-spacing: -0.005em;
            line-height: 1.35;
            margin-bottom: 0;
        }

        .section-subtitle { display: none; }

        input[type="number"],
        input[type="text"],
        select {
            width: 100%;
            height: clamp(46px, 11vw, 52px);
            border: 1px solid #dfe7f2;
            border-radius: 16px;
            background: #f9fbff;
            color: #1f2937;
            font-size: var(--fs-input);
            padding: 0 clamp(12px, 3.6vw, 14px);
            line-height: 1;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }

        input::placeholder {
            color: #9aa4b5;
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='14' height='8' viewBox='0 0 14 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 1.5L7 6L12 1.5' stroke='%236B7280' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            padding-right: 32px;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--blue-3);
            box-shadow: 0 0 0 2px rgba(26, 95, 207, 0.12);
            background: #f8faff;
        }

        .input-with-unit {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .input-with-unit input {
            flex: 1;
        }

        .unit {
            min-width: clamp(24px, 7vw, 30px);
            color: #99a2b2;
            text-align: left;
            font-size: var(--fs-unit);
            font-weight: 700;
        }

        .help-text {
            margin-top: 0;
            font-size: var(--fs-help);
            line-height: 1.42;
            color: var(--text-sub);
            overflow-wrap: anywhere;
        }

        .info-text {
            display: none;
            margin-top: 0;
            border-radius: 14px;
            background: #eef3fc;
            color: #446093;
            padding: 12px 14px;
            font-size: var(--fs-help);
            line-height: 1.42;
            border: 2px solid #bfd5fa;
            font-weight: 700;
            overflow-wrap: anywhere;
        }

        .info-text.show {
            display: block;
        }

        .info-text.error {
            color: #dc2626;
            border-color: #f8b4b4;
            background: #fef2f2;
        }

        .info-text.muted {
            color: #1f8f62;
            border-color: #9de7c5;
            background: #eaf9f1;
        }

        .info-text.primary {
            color: #2e68df;
            border-color: #b5d2ff;
            background: #edf4ff;
        }

        .info-text.warning {
            color: #96620d;
            border-color: #f6d48a;
            background: #fff8e8;
        }

        .highlight-box {
            margin-top: 0;
            border-radius: 14px;
            background: #edf4ff;
            color: #2e68df;
            padding: 12px 14px;
            border: 2px solid #b5d2ff;
            display: none;
            font-size: var(--fs-input);
            line-height: 1.5;
            overflow-wrap: anywhere;
        }

        .preview-meta {
            font-size: var(--fs-help);
            color: #334155;
        }

        .mde-buttons {
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: var(--space-2);
            margin-bottom: 0;
        }

        .mde-btn {
            height: calc(var(--control-h) - 6px);
            border-radius: 6px;
            border: 1px solid #c6cfdb;
            background: #f8fafd;
            color: #334155;
            font-size: var(--fs-input);
            font-weight: 700;
            cursor: pointer;
            transition: border-color 0.15s ease, background-color 0.15s ease;
        }

        .mde-btn:hover {
            border-color: var(--blue-3);
        }

        .mde-btn.active {
            color: #fff;
            border-color: var(--blue-3);
            background: linear-gradient(135deg, var(--blue-1), var(--blue-2));
        }

        .chip-btn {
            border: 1px solid #c6cfdb;
            border-radius: 6px;
            background: #f8fafd;
            color: #3b4454;
            font-size: var(--fs-help);
            font-weight: 700;
            height: calc(var(--control-h) - 10px);
            padding: 0 var(--space-4);
            cursor: pointer;
        }

        .chip-btn:hover {
            border-color: var(--blue-3);
            background: #edf4ff;
        }

        .comparison-box {
            display: none;
            margin-top: 0;
            border-radius: 8px;
            padding: var(--space-3) var(--space-4);
            font-size: var(--fs-input);
            line-height: 1.5;
        }

        .comparison-suggestions {
            margin-top: var(--space-3);
        }

        .comparison-box.success {
            display: block;
            background: #eaf8ef;
            color: #126645;
            border: 1px solid #92d6af;
        }

        .comparison-box.warning {
            display: block;
            background: #fdf7e8;
            color: #946103;
            border: 1px solid #efce84;
        }

        .comparison-box.error {
            display: block;
            background: #fbecee;
            color: #a11f2f;
            border: 1px solid #efb3bc;
        }

        .collapsible {
            border: 1px solid #d6e0ee;
            border-radius: var(--radius-md);
            overflow: hidden;
            background: #ffffff;
        }

        .subsection-divider {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin: 16px 0 10px;
        }

        .subsection-divider::before,
        .subsection-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #cdd5e3;
        }

        .subsection-divider span {
            font-size: var(--fs-label);
            font-weight: 800;
            color: #6a778f;
            letter-spacing: 0.01em;
            white-space: nowrap;
        }

        .collapsible-header {
            background: #ffffff;
            color: #3f4b61;
            font-size: var(--fs-label);
            font-weight: 800;
            padding: var(--space-3) var(--space-4);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 2px solid transparent;
            border-radius: var(--radius-md);
        }

        .collapsible-header.open {
            border-color: #1b63ca;
        }

        .collapsible-content {
            display: none;
            background: transparent;
            border-top: 1px solid #e3e9f2;
            padding: var(--space-3) var(--space-4) 0;
        }

        .collapsible-content.show {
            display: block;
        }

        .collapsible-arrow {
            font-size: var(--fs-label);
            color: #374151;
            transform: rotate(180deg);
            transition: transform 0.2s ease;
        }

        .collapsible-header.open .collapsible-arrow {
            transform: rotate(0deg);
        }

        .inline-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--row-gap);
        }

        .action-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-3);
        }

        .calculate-btn,
        .reset-btn,
        .copy-btn {
            height: var(--control-h);
            border-radius: 6px;
            border: 1px solid transparent;
            font-size: var(--fs-btn);
            font-weight: 800;
            cursor: pointer;
        }

        .calculate-btn {
            color: #fff;
            background: linear-gradient(135deg, var(--blue-1) 0%, var(--blue-2) 100%);
            box-shadow: 0 1px 4px rgba(31, 99, 212, 0.24);
        }

        .calculate-btn:hover {
            filter: brightness(1.03);
        }

        .reset-btn,
        .copy-btn {
            background: #f3f7fd;
            color: #374151;
            border-color: #d9e3f0;
        }

        .copy-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            min-width: 118px;
            padding: 0 var(--space-5);
        }

        .copy-icon {
            width: 14px;
            height: 14px;
            color: #374151;
            fill: currentColor;
            flex-shrink: 0;
        }

        .reset-btn:hover,
        .copy-btn:hover {
            background: #eaf2fb;
        }

        .results {
            margin-top: var(--space-5);
            display: none;
            max-width: 100%;
        }

        .results.show {
            display: block;
        }

        .result-section {
            border-radius: var(--radius-lg);
            border: 1px solid #dfe7f3;
            background: #ffffff;
            box-shadow: var(--card-shadow);
            padding: var(--space-4);
            margin-bottom: var(--space-3);
            max-width: 100%;
            overflow-x: auto;
        }

        .result-hero {
            background: linear-gradient(180deg, #ddf5ea 0%, #d3efe2 100%);
            border: 1px solid #a8d7bf;
            text-align: center;
            padding: calc(var(--space-6) + var(--space-1)) var(--space-4);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.55), 0 1px 6px rgba(16, 120, 84, 0.08);
        }

        .result-section h3 {
            font-size: var(--fs-label);
            font-weight: 800;
            margin-bottom: var(--space-2);
            color: #1f2937;
        }

        .result-hero h3 {
            color: #0f6f4f;
        }

        .result-main {
            font-size: clamp(25px, 6vw, 41px);
            font-weight: 900;
            color: var(--mint-text);
            line-height: 1;
            margin-bottom: var(--space-2);
            letter-spacing: -0.02em;
        }

        .result-label {
            font-size: var(--fs-input);
            color: #5f697b;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 0;
        }

        .result-card {
            border-right: 1px solid #e1e6ee;
            padding: 7px 6px;
            text-align: center;
            background: transparent;
        }

        .result-card:last-child {
            border-right: none;
        }

        .result-card-label {
            font-size: var(--fs-input);
            color: #6b7280;
            margin-bottom: var(--space-1);
        }

        .result-card-value {
            font-size: clamp(15px, 2.4vw, 21px);
            font-weight: 800;
            color: #111827;
            letter-spacing: -0.01em;
        }

        .result-report {
            border: 1px solid #dbe2ee;
            border-radius: 10px;
            background: #ffffff;
            padding: var(--space-4);
            color: #344255;
            font-size: var(--fs-input);
            line-height: 1.65;
            white-space: pre-line;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--fs-input);
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
        }

        .table th,
        .table td {
            border-bottom: 1px solid #e0e4ea;
            padding: var(--space-2) var(--space-3);
            text-align: left;
        }

        .table th {
            font-size: var(--fs-input);
            color: #4b5568;
            background: #eef2f7;
            font-weight: 700;
        }

        .result-actions {
            display: flex;
            justify-content: center;
            margin-top: var(--space-3);
            margin-bottom: var(--space-5);
        }

        .footer {
            text-align: center;
            padding: 0 var(--space-4) calc(var(--space-4) + env(safe-area-inset-bottom));
            color: #64748b;
            font-size: var(--fs-help);
        }

        .custom-k-wrap,
        .chip-wrap {
            margin-top: var(--space-3);
        }

        .is-hidden {
            display: none !important;
        }

        .footer a {
            color: var(--blue-3);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .guide-box,
        .content,
        .content-inner,
        .table,
        .action-row {
            max-width: 100%;
        }

        @media (max-width: 767px) {
            .container {
                border-radius: 10px;
            }

            .header {
                padding: 7px 9px;
            }

            .content {
                padding: 0;
            }

            .guide-box {
                padding: 10px 12px;
            }

            .settings-card {
                border-radius: 18px;
                padding: 16px 14px;
            }

            .section-row,
            .inline-row {
                grid-template-columns: 1fr;
                gap: var(--row-gap);
            }

            .mde-buttons {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .action-row {
                grid-template-columns: 1fr;
                gap: var(--space-3);
            }

            .result-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }

            .result-card {
                border-right: 1px solid #e1e6ee;
                border-bottom: none;
                padding: 6px 4px;
            }

            .result-card:last-child {
                border-right: none;
            }

            .result-card-label {
                font-size: calc(var(--fs-input) - 1px);
                white-space: nowrap;
            }

            .result-card-value {
                font-size: clamp(12px, 3.2vw, 16px);
            }

            .subsection-divider {
                margin: 14px 0 8px;
            }
        }

        @media (max-width: 1024px) {
            .container {
                max-width: 100%;
            }

            .section-row,
            .metric-goal-row,
            .inline-row {
                grid-template-columns: 1fr !important;
            }

            .action-row {
                grid-template-columns: 1fr;
                gap: var(--space-3);
                position: static;
                padding: 0;
                border: 0;
                background: transparent;
                backdrop-filter: none;
            }
        }

        @media (max-width: 420px) {
            .card-title {
                font-size: calc(var(--fs-step) + 4px);
            }

            .step-label {
                line-height: 1.3;
            }

            .mde-btn {
                font-size: calc(var(--fs-input) - 0.5px);
            }
        }

        @media (min-width: 768px) and (max-width: 1199px) {
            :root {
                --fs-body: 14.5px;
                --fs-title: 25px;
                --fs-version: 13px;
                --fs-label: 13px;
                --fs-step: 16px;
                --fs-input: 14px;
                --fs-help: 12px;
                --fs-unit: 14px;
                --fs-btn: 14px;
                --badge-size: 27px;
                --badge-fs: 16px;
                --control-h: 42px;
                --row-gap: 15px;
                --space-1: 4px;
                --space-2: 7px;
                --space-3: 10px;
                --space-4: 12px;
                --space-5: 14px;
                --space-6: 16px;
            }

            body {
                padding: 10px;
            }

            .container {
                max-width: 980px;
            }

            .content {
                padding: var(--space-3) var(--space-4) var(--space-4);
            }

            .section-row,
            .inline-row {
                grid-template-columns: 1fr;
                gap: var(--row-gap);
            }

            .action-row {
                grid-template-columns: 1fr;
                gap: var(--space-3);
            }

            .result-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }

            .result-card {
                border-right: 1px solid #e1e6ee;
                border-bottom: none;
            }

            .result-card:last-child {
                border-right: none;
            }
        }

        @media (min-width: 1200px) {
            :root {
                --fs-body: 15px;
                --fs-title: 27px;
                --fs-version: 13.5px;
                --fs-label: 13.5px;
                --fs-step: 16.5px;
                --fs-input: 14.5px;
                --fs-help: 12.25px;
                --fs-unit: 14.5px;
                --fs-btn: 14.5px;
                --badge-size: 28px;
                --badge-fs: 16.5px;
                --control-h: 43px;
                --row-gap: 16px;
                --space-1: 4px;
                --space-2: 8px;
                --space-3: 10px;
                --space-4: 13px;
                --space-5: 16px;
                --space-6: 18px;
            }

            body {
                padding: 14px;
            }

            .container {
                max-width: 1240px;
            }

            .content {
                padding: var(--space-4) var(--space-5) var(--space-5);
            }

            .content-inner {
                max-width: 1200px;
            }

            #calculator-form {
                gap: var(--space-4);
            }

            .header {
                padding: 9px 14px;
            }

            .section-row {
                grid-template-columns: repeat(2, minmax(0, 1fr));
                gap: var(--row-gap);
            }

            .paired-steps {
                grid-template-columns: 1.1fr 0.9fr;
            }

            .traffic-row {
                grid-template-columns: 1.05fr 0.95fr;
            }

            .group-row {
                grid-template-columns: 0.95fr 1.05fr;
            }

            .metric-goal-row {
                grid-template-columns: 1.12fr 0.88fr;
            }

            .inline-row {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .action-row {
                grid-template-columns: 1fr 116px;
            }
        }

        @media (max-width: 1199px) {
            .footer {
                padding-bottom: calc(var(--space-4) + env(safe-area-inset-bottom));
            }
        }

        @media (max-height: 520px) and (orientation: landscape) {
            body {
                padding: 8px;
            }

            #calculator-form {
                gap: 12px;
            }

            .guide-box {
                padding: 10px 12px;
            }

            .settings-card {
                padding: 14px;
            }

            .form-group {
                gap: 7px;
                margin-bottom: 6px;
            }

            .section-row.metric-goal-row,
            .inline-row {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .mde-buttons {
                grid-template-columns: repeat(4, minmax(0, 1fr));
            }

            .action-row {
                grid-template-columns: 1fr;
            }

            .result-section {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <span class="drag-icon">‚ãÆ‚ãÆ</span>
                <div class="title-line">
                    <h1>Ïã§Ìóò Í≥ÑÏÇ∞Í∏∞</h1>
                    <span class="version-badge">Mark8</span>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="content-inner">
            <form id="calculator-form">
                <div class="guide-box">
                    <ol>
                        <li>ÎèôÏùº ÏßÄÎ©¥ÏóêÏÑú Ïó¨Îü¨ Ïã§ÌóòÏùÑ ÏßÑÌñâÌï† Îïå ÏÉòÌîåÏù¥ Í≤πÏπòÏßÄ ÏïäÎèÑÎ°ù Ïä¨Î°ØÏùÑ ÎÇòÎà† ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.</li>
                        <li>Ïã§Ìóò Í∏∞Í∞Ñ, Î∞©Î¨∏ Ïàò, Ìä∏ÎûòÌîΩ ÏÇ¨Ïö©Î•†ÏùÑ ÏûÖÎ†•ÌïòÎ©¥ Í∂åÏû• Ïä¨Î°Ø ÏàòÎ•º ÏûêÎèôÏúºÎ°ú Í≥ÑÏÇ∞Ìï©ÎãàÎã§.</li>
                    </ol>
                </div>

                <div class="settings-card">
                    <div class="card-header">
                        <div class="card-title">Í≥†Ïú† Ïú†Ï†Ä Í≥ÑÏÇ∞ÌïòÍ∏∞</div>
                    </div>

                    <div class="form-group">
                        <label class="step-label" for="prop-duration">Ïã§Ìóò Í∏∞Í∞ÑÏùÄ Î©∞Ïπ†Ïù∏Í∞ÄÏöî?</label>
                        <div class="input-with-unit">
                            <input type="number" id="prop-duration" value="14" min="1" step="1" required>
                            <span class="unit">Ïùº</span>
                        </div>
                        <div class="info-text" id="duration-feedback"></div>
                    </div>

                    <div class="form-group">
                        <label class="step-label" for="prop-daily-visitors">ÌïòÎ£®Ïóê Î™á Î™ÖÏù¥ Î∞©Î¨∏ÌïòÎÇòÏöî?</label>
                        <div class="input-with-unit">
                            <input type="number" id="prop-daily-visitors" placeholder="Ïòà: 100000" min="1" step="1" required>
                            <span class="unit">Î™Ö/Ïùº</span>
                        </div>
                        <div class="info-text" id="visitors-feedback"></div>
                    </div>

                    <div class="form-group">
                        <label class="step-label" for="traffic-usage">Ï†ÑÏ≤¥ Ìä∏ÎûòÌîΩ Ï§ë Ïã§Ìóò ÏÇ¨Ïö© ÎπÑÏú®</label>
                        <div class="input-with-unit">
                            <input type="number" id="traffic-usage" value="100" min="1" max="100" step="1" required>
                            <span class="unit">%</span>
                        </div>
                        <div class="help-text">Ïòà: 70 ÏûÖÎ†• Ïãú Ï∂îÏ†ï Í≥†Ïú† Ïú†Ï†ÄÏùò 70%Îßå Ïã§ÌóòÏóê ÏÇ¨Ïö©Ìï©ÎãàÎã§.</div>
                        <div class="highlight-box" id="preview-users"></div>
                    </div>
                </div>

                <div class="settings-card">
                    <div class="card-header">
                        <div class="card-title">Ïã§Ìóò Í∑∏Î£π Î∞∞Î∂ÑÌïòÍ∏∞</div>
                    </div>

                    <div class="form-group">
                        <label class="step-label" for="group-count">Ïã§Ìóò Í∑∏Î£π Ïàò (ÎåÄÏ°∞Íµ∞ Ìè¨Ìï®)</label>
                        <select id="group-count">
                            <option value="2" selected>2Í∞ú (A/B)</option>
                            <option value="3">3Í∞ú (A/B/C)</option>
                            <option value="4">4Í∞ú (A/B/C/D)</option>
                            <option value="5">5Í∞ú (A/B/C/D/E)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="step-label" for="group-ratios">Î∞∞Î∂Ñ ÎπÑÏú®ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</label>
                        <input type="text" id="group-ratios" value="50,50" placeholder="Ïòà: 50,30,20">
                        <div class="help-text">Ï≤´ Î≤àÏß∏ Í∞íÏùÄ ÎåÄÏ°∞Íµ∞ÏûÖÎãàÎã§. ÏâºÌëúÎ°ú Íµ¨Î∂ÑÌïòÏÑ∏Ïöî.</div>
                        <div class="chip-wrap">
                            <button type="button" class="chip-btn" id="apply-even-ratio">Í∑†Îì± ÎπÑÏ§ë ÏûêÎèôÏûÖÎ†•</button>
                        </div>
                        <div class="info-text" id="ratio-feedback"></div>
                    </div>
                </div>

                <div class="settings-card">
                    <div class="card-header">
                        <div class="card-title">ÏµúÏÜå Í∞êÏßÄ Ìö®Í≥º Í≥ÑÏÇ∞ÌïòÍ∏∞</div>
                    </div>

                    <div class="section-row metric-goal-row">
                        <div class="form-group">
                            <label class="step-label" for="prop-baseline">Î™©Ìëú ÏßÄÌëúÏùò ÌòÑÏû¨ ÏàòÏ§ÄÏùÄ Ïñ¥Îñ§Í∞ÄÏöî?</label>
                            <div class="input-with-unit">
                                <input type="number" id="prop-baseline" placeholder="Ïòà: 3" min="0" max="100" step="0.0001" required>
                                <span class="unit">%</span>
                            </div>
                            <div class="help-text">Î™©ÌëúÌïòÎäî ÏßÄÌëúÏùò ÏµúÍ∑º ÏùºÌèâÍ∑† Í∞íÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî. (CTR, CVR Îì±)</div>
                            <div class="highlight-box" id="mde-preview"></div>
                        </div>

                        <div class="form-group">
                            <label class="step-label" for="mde-mode">Ïù¥ ÏßÄÌëúÎ•º ÏñºÎßàÎÇò Í∞úÏÑ†ÌïòÍ≥† Ïã∂ÏúºÏã†Í∞ÄÏöî?</label>
                            <select id="mde-mode">
                                <option value="relative" selected>ÏÉÅÎåÄ Í∞úÏÑ†Ïú® (%)</option>
                                <option value="absolute">Ï†àÎåÄ Í∞úÏÑ†Ìè≠ (%p)</option>
                            </select>

                            <div class="mde-buttons" id="mde-buttons"></div>

                            <div class="input-with-unit">
                                <input type="number" id="prop-mde" placeholder="Ïòà: 5" min="0" step="0.0001" required>
                                <span class="unit" id="mde-unit">%</span>
                            </div>
                            <div class="help-text" id="mde-help">ÏÉÅÎåÄ Í∞úÏÑ†Ïú® Í∏∞Ï§ÄÏúºÎ°ú Î™©ÌëúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.</div>
                            <div class="comparison-box" id="mde-comparison"></div>
                        </div>
                    </div>

                    <div class="subsection-divider">
                        <span>Í≥†Í∏â ÏÑ§Ï†ï</span>
                    </div>

                    <div class="collapsible">
                        <div class="collapsible-header" id="advanced-toggle" role="button" aria-expanded="false" aria-controls="advanced-content">
                            <span>‚öôÔ∏è Í≥†Í∏â ÏÑ§Ï†ï</span>
                            <span class="collapsible-arrow" aria-hidden="true">‚åÉ</span>
                        </div>
                        <div class="collapsible-content" id="advanced-content">
                            <div class="inline-row">
                                <div class="form-group">
                                    <label for="confidence-level">Ïã†Î¢∞ÎèÑ (Confidence)</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="confidence-level" value="95" min="50" max="99.9" step="0.1">
                                        <span class="unit">%</span>
                                    </div>
                                    <div class="help-text">ÏùºÎ∞òÏ†ÅÏúºÎ°ú 95%Î•º ÏÇ¨Ïö©Ìï©ÎãàÎã§ (ÏñëÏ∏° Í≤ÄÏ†ï).</div>
                                </div>

                                <div class="form-group">
                                    <label for="power-level">Í≤ÄÏ†ïÎ†• (Power)</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="power-level" value="80" min="50" max="99.9" step="0.1">
                                        <span class="unit">%</span>
                                    </div>
                                    <div class="help-text">ÏùºÎ∞òÏ†ÅÏúºÎ°ú 80%Î•º ÏÇ¨Ïö©Ìï©ÎãàÎã§.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="action-row">
                    <button type="submit" class="calculate-btn">üé∞ Ïä¨Î°Ø Í≥ÑÏÇ∞ÌïòÍ∏∞</button>
                    <button type="reset" class="reset-btn" id="reset-form">Ï¥àÍ∏∞Ìôî</button>
                </div>
            </form>

            <div class="results" id="results">
                <div class="result-section result-hero">
                    <h3>üé∞ ÌïÑÏöîÌïú Ïä¨Î°Ø</h3>
                    <div class="result-main" id="result-slot-range">-</div>
                    <div class="result-label" id="result-slot-percentage">-</div>
                </div>

                <div class="result-section">
                    <div class="result-grid">
                        <div class="result-card">
                            <div class="result-card-label">Ï¥ù ÌïÑÏöî ÏÉòÌîå</div>
                            <div class="result-card-value" id="result-total-required">-</div>
                        </div>
                        <div class="result-card">
                            <div class="result-card-label">Ïã§Ìóò Í∏∞Í∞Ñ</div>
                            <div class="result-card-value" id="result-duration">-</div>
                        </div>
                        <div class="result-card">
                            <div class="result-card-label">Î∞∞Î∂Ñ</div>
                            <div class="result-card-value" id="result-allocation">-</div>
                        </div>
                    </div>
                </div>

                <div class="result-section">
                    <h3>üìù Í≥ÑÏÇ∞ Í≤∞Í≥º Î≥¥Í≥†ÏÑú</h3>
                    <div class="result-report" id="result-report">-</div>
                </div>

                <div class="result-actions">
                    <button type="button" class="copy-btn" id="copy-result-btn">
                        <svg class="copy-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path d="M8 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V5a3 3 0 0 0-3-3H8zm0 2h10a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1z"></path>
                            <path d="M5 8a1 1 0 0 0-1 1v9a3 3 0 0 0 3 3h9a1 1 0 1 0 0-2H7a1 1 0 0 1-1-1V9a1 1 0 0 0-1-1z"></path>
                        </svg>
                        <span>Í≤∞Í≥º Î≥µÏÇ¨</span>
                    </button>
                </div>
            </div>
            </div>
        </div>

        <div class="footer">
            Built by <a href="mailto:zonetwo.project@gmail.com">zonetwo.project</a> |
            <a href="https://github.com/zonetwoproject/ab-test-calculator" target="_blank">GitHub</a>
        </div>
    </div>

    <script type="module">
        import {
            TOTAL_SLOTS,
            PRESET_MDE,
            FIXED_K_META,
            formatNumber,
            getDefaultRatios,
            parseGroupRatios,
            calculateDetectableMde,
            validateBaseFormData,
            validateFormData,
            calculateExperiment
        } from '../../shared/mark8-core.js';

        const CONFIG = {
            TOTAL_SLOTS,
            PRESET_MDE
        };

        let latestResultSummary = '';

        function getKValueOrThrow() {
            return FIXED_K_META;
        }

        function getFormData() {
            return {
                duration: parseInt(document.getElementById('prop-duration').value, 10),
                dailyVisitors: parseFloat(document.getElementById('prop-daily-visitors').value),
                trafficUsagePct: parseFloat(document.getElementById('traffic-usage').value),
                groupCount: parseInt(document.getElementById('group-count').value, 10),
                groupRatiosText: document.getElementById('group-ratios').value,
                baselinePct: parseFloat(document.getElementById('prop-baseline').value),
                mdeMode: document.getElementById('mde-mode').value,
                mdeInput: parseFloat(document.getElementById('prop-mde').value),
                confidencePct: parseFloat(document.getElementById('confidence-level').value),
                powerPct: parseFloat(document.getElementById('power-level').value)
            };
        }

        function updateDurationFeedback() {
            const days = parseInt(document.getElementById('prop-duration').value, 10);
            const feedback = document.getElementById('duration-feedback');
            feedback.classList.remove('error', 'muted');

            if (!days || days < 1) {
                feedback.classList.add('show');
                feedback.classList.add('error');
                feedback.textContent = '‚ùå 1Ïùº Ïù¥ÏÉÅ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.';
                return;
            }

            feedback.classList.add('show');
            feedback.classList.add('muted');
            if (days < 7) {
                feedback.textContent = `üí° ${days}ÏùºÏùÄ 7Ïùº ÎØ∏ÎßåÏúºÎ°ú ÏöîÏùº Ìö®Í≥ºÍ∞Ä ÎÇ®ÏùÑ Ïàò ÏûàÏäµÎãàÎã§.`;
                return;
            }
            if (days < 14) {
                feedback.textContent = `‚úÖ ${days}ÏùºÏùÄ Í∞ÄÎä•ÌïòÏßÄÎßå, 14Ïùº Ïù¥ÏÉÅÏù¥ Îçî ÏïàÏ†ïÏ†ÅÏûÖÎãàÎã§.`;
                return;
            }
            feedback.textContent = `‚úÖ ${days}ÏùºÏùÄ ÏöîÏùº Ìö®Í≥ºÎ•º Ï†úÍ±∞ÌïòÍ∏∞Ïóê Ï∂©Î∂ÑÌïú Í∏∞Í∞ÑÏûÖÎãàÎã§.`;
        }

        function updateVisitorsFeedback() {
            const visitorInput = document.getElementById('prop-daily-visitors');
            const rawValue = visitorInput.value.trim();
            const visitors = parseFloat(rawValue);
            const feedback = document.getElementById('visitors-feedback');
            feedback.classList.remove('error', 'muted');

            if (!rawValue) {
                feedback.classList.add('show');
                feedback.classList.add('muted');
                feedback.innerHTML = `Ïã§Ìóò Î∂ÑÎ∞∞ Îã®ÏúÑ Í∏∞Ï§Ä, ÏµúÍ∑º 1Í∞úÏõî Í∏∞Ï§Ä ÏùºÌèâÍ∑† Î∞©Î¨∏ ÏàòÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî<br>(Ïòà. ÎîîÎ∞îÏù¥Ïä§ Í∏∞Ï§Ä Ïã§ÌóòÏùò Í≤ΩÏö∞ device_idÏùò ÏùºÌèâÍ∑† Î∞©Î¨∏)`;
                return;
            }

            if (!Number.isFinite(visitors) || visitors < 1) {
                feedback.classList.add('show');
                feedback.classList.add('error');
                feedback.textContent = '‚ùå 1Î™Ö Ïù¥ÏÉÅ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.';
                return;
            }

            if (visitors < 1000) {
                feedback.classList.add('show');
                feedback.classList.add('muted');
                feedback.textContent = 'üí° Ìä∏ÎûòÌîΩÏù¥ ÎÇÆÏïÑ Ïã§Ìóò Í∏∞Í∞ÑÏù¥ Í∏∏Ïñ¥Ïßà Ïàò ÏûàÏäµÎãàÎã§.';
                return;
            }

            feedback.classList.remove('show');
        }

        function updateUniqueUsersPreview() {
            const previewBox = document.getElementById('preview-users');
            const formData = getFormData();

            if (!formData.duration || !formData.dailyVisitors || !formData.trafficUsagePct) {
                previewBox.style.display = 'none';
                return;
            }

            try {
                const kMeta = getKValueOrThrow();
                const totalUniqueUsers = Math.round((formData.dailyVisitors * formData.duration) / kMeta.k);
                const availableUsers = Math.round(totalUniqueUsers * (formData.trafficUsagePct / 100));

                previewBox.style.display = 'block';
                previewBox.innerHTML = `
                    <strong>üí° ÏòàÏÉÅ Í≥†Ïú† Ïú†Ï†Ä: ÏïΩ ${formatNumber(totalUniqueUsers)}Î™Ö</strong><br>
                    Ïã§Ìóò ÏÇ¨Ïö© ÎπÑÏú® ${formData.trafficUsagePct}% Ï†ÅÏö© Ïãú: <strong>${formatNumber(availableUsers)}Î™Ö</strong><br>
                    <span class="preview-meta">
                        Í≥ÑÏÇ∞: (${formatNumber(formData.dailyVisitors)} √ó ${formData.duration}Ïùº) √∑ ${kMeta.k.toFixed(2)} √ó ${formData.trafficUsagePct}% (K=1 Í≥†Ï†ï)
                    </span>
                `;
            } catch {
                previewBox.style.display = 'none';
            }
        }

        function updateRatioFeedback() {
            const groupCount = parseInt(document.getElementById('group-count').value, 10);
            const feedback = document.getElementById('ratio-feedback');
            feedback.classList.remove('error', 'primary');
            try {
                const ratioMeta = parseGroupRatios(document.getElementById('group-ratios').value, groupCount);
                const control = ratioMeta.values[0].toFixed(2).replace(/\.00$/, '');
                const treatments = ratioMeta.values.slice(1).map((v) => v.toFixed(2).replace(/\.00$/, '')).join(' / ');
                feedback.classList.add('show');
                feedback.classList.add('primary');
                feedback.textContent = `ÎåÄÏ°∞Íµ∞ ${control}% | Ïã§ÌóòÍµ∞ ${treatments}%`;
            } catch (error) {
                feedback.classList.add('show');
                feedback.classList.add('error');
                feedback.textContent = error.message;
            }
        }

        function updateMdeModeUI() {
            const mode = document.getElementById('mde-mode').value;
            const unit = document.getElementById('mde-unit');
            const help = document.getElementById('mde-help');
            const input = document.getElementById('prop-mde');
            const buttonWrap = document.getElementById('mde-buttons');
            const values = CONFIG.PRESET_MDE[mode];

            if (mode === 'relative') {
                unit.textContent = '%';
                help.textContent = 'ÏÉÅÎåÄ Í∞úÏÑ†Ïú® Í∏∞Ï§ÄÏúºÎ°ú Î™©ÌëúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.';
                input.step = '0.0001';
                input.min = '0';
                input.placeholder = 'Ïòà: 5';
            } else {
                unit.textContent = '%p';
                help.textContent = 'Ï†àÎåÄ Í∞úÏÑ†Ìè≠(%p) Í∏∞Ï§ÄÏúºÎ°ú Î™©ÌëúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî. Ïòà: 0.2%p';
                input.step = '0.0001';
                input.min = '0';
                input.placeholder = 'Ïòà: 0.2';
            }

            buttonWrap.innerHTML = values
                .map((value) => {
                    const label = mode === 'relative' ? `+${value}%` : `+${value}%p`;
                    return `<button type="button" class="mde-btn" data-value="${value}">${label}</button>`;
                })
                .join('');

            const currentValue = Number(input.value);
            document.querySelectorAll('.mde-btn').forEach((button) => {
                if (Number(button.dataset.value) === currentValue) {
                    button.classList.add('active');
                }
                button.addEventListener('click', () => {
                    document.getElementById('prop-mde').value = button.dataset.value;
                    document.querySelectorAll('.mde-btn').forEach((btn) => btn.classList.remove('active'));
                    button.classList.add('active');
                    updateMdePreview();
                    updateMdeComparison();
                });
            });
        }

        function getPreviewContext() {
            const formData = getFormData();
            const ratioMeta = parseGroupRatios(formData.groupRatiosText, formData.groupCount);
            const kMeta = getKValueOrThrow();
            validateBaseFormData(formData, ratioMeta);

            const totalUniqueUsers = Math.round((formData.dailyVisitors * formData.duration) / kMeta.k);
            const availableUsers = Math.round(totalUniqueUsers * (formData.trafficUsagePct / 100));

            return {
                formData,
                ratioMeta,
                kMeta,
                totalUniqueUsers,
                availableUsers
            };
        }

        function updateMdePreview() {
            const previewBox = document.getElementById('mde-preview');
            const formData = getFormData();

            if (!Number.isFinite(formData.baselinePct)) {
                previewBox.style.display = 'none';
                return;
            }

            previewBox.style.display = 'block';

            if (formData.baselinePct <= 0 || formData.baselinePct >= 100) {
                previewBox.innerHTML = '‚ùå ÌòÑÏû¨ ÏßÄÌëúÎäî 0 Ï¥àÍ≥º 100 ÎØ∏ÎßåÏúºÎ°ú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.';
                return;
            }

            try {
                const ratioMeta = parseGroupRatios(formData.groupRatiosText, formData.groupCount);
                const hasRequiredContext = Number.isFinite(formData.duration) && formData.duration >= 1
                    && Number.isFinite(formData.dailyVisitors) && formData.dailyVisitors >= 1
                    && Number.isFinite(formData.trafficUsagePct) && formData.trafficUsagePct > 0 && formData.trafficUsagePct <= 100
                    && Number.isFinite(formData.confidencePct) && formData.confidencePct > 50 && formData.confidencePct < 100
                    && Number.isFinite(formData.powerPct) && formData.powerPct > 50 && formData.powerPct < 100;

                if (!hasRequiredContext) {
                    previewBox.innerHTML = 'üí° ÌòÑÏû¨ ÏßÄÌëúÍ∞Ä ÏûÖÎ†•ÎêòÏóàÏäµÎãàÎã§. Ïã§Ìóò Í∏∞Í∞Ñ/ÌïòÎ£® Î∞©Î¨∏Ïàò/Ìä∏ÎûòÌîΩ ÏÇ¨Ïö© ÎπÑÏú®ÏùÑ ÏûÖÎ†•ÌïòÎ©¥ ÏµúÏÜå Ìö®Í≥ºÎ•º Í≥ÑÏÇ∞Ìï©ÎãàÎã§.';
                    return;
                }

                const kMeta = getKValueOrThrow();
                const totalUniqueUsers = Math.round((formData.dailyVisitors * formData.duration) / kMeta.k);
                const availableUsers = Math.round(totalUniqueUsers * (formData.trafficUsagePct / 100));

                const detectable = calculateDetectableMde(
                    availableUsers,
                    formData.baselinePct,
                    ratioMeta.ratios[0],
                    ratioMeta.ratios.slice(1),
                    formData.confidencePct,
                    formData.powerPct
                );

                if (!detectable) {
                    previewBox.innerHTML = '‚ùå ÌòÑÏû¨ ÏûÖÎ†•Í∞íÏúºÎ°ú ÏµúÏÜå Í∞êÏßÄ Ìö®Í≥ºÎ•º Í≥ÑÏÇ∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§.';
                    return;
                }

                const newValue = formData.baselinePct + detectable.absolutePctPoint;
                previewBox.innerHTML = `
                    üéØ ÌòÑÏû¨ Ï°∞Í±¥ÏóêÏÑú Í≤ÄÏ¶ù Í∞ÄÎä•Ìïú ÏµúÏÜå Ìö®Í≥º<br>
                    <strong>ÏÉÅÎåÄ ${detectable.relativePct.toFixed(4)}%</strong> / Ï†àÎåÄ ${detectable.absolutePctPoint.toFixed(3)}%p<br>
                    Í∏∞Ï§Ä ${formData.baselinePct.toFixed(2)}% ‚Üí ${newValue.toFixed(2)}%
                `;
            } catch (error) {
                previewBox.innerHTML = `‚ùå ${error.message}`;
            }
        }

        function updateMdeComparison() {
            const comparisonBox = document.getElementById('mde-comparison');

            try {
                const { formData, ratioMeta } = getPreviewContext();
                if (!formData.mdeInput || !formData.baselinePct) {
                    comparisonBox.className = 'comparison-box';
                    return;
                }
                validateFormData(formData, ratioMeta);

                const kMeta = getKValueOrThrow();
                const totalUniqueUsers = Math.round((formData.dailyVisitors * formData.duration) / kMeta.k);
                const availableUsers = Math.round(totalUniqueUsers * (formData.trafficUsagePct / 100));
                const detectable = calculateDetectableMde(
                    availableUsers,
                    formData.baselinePct,
                    ratioMeta.ratios[0],
                    ratioMeta.ratios.slice(1),
                    formData.confidencePct,
                    formData.powerPct
                );

                if (!detectable) {
                    comparisonBox.className = 'comparison-box';
                    return;
                }

                const targetRelative = formData.mdeMode === 'relative'
                    ? formData.mdeInput
                    : (formData.mdeInput / formData.baselinePct) * 100;

                if (!Number.isFinite(targetRelative) || targetRelative <= 0) {
                    comparisonBox.className = 'comparison-box';
                    return;
                }

                if (targetRelative > detectable.relativePct * 1.5) {
                    comparisonBox.className = 'comparison-box success';
                    comparisonBox.innerHTML = `
                        ÏµúÏÜå Í∞êÏßÄ Í∞ÄÎä• Í∞úÏÑ†: ${detectable.relativePct.toFixed(4)}% (ÏÉÅÎåÄ)<br>
                        Î™©Ìëú(${targetRelative.toFixed(2)}%)Îäî Ï∂©Î∂ÑÌûà Í≤ÄÏ¶ù Í∞ÄÎä•Ìï©ÎãàÎã§.
                    `;
                    return;
                }

                if (targetRelative >= detectable.relativePct) {
                    comparisonBox.className = 'comparison-box warning';
                    comparisonBox.innerHTML = `
                        ÏµúÏÜå Í∞êÏßÄ Í∞ÄÎä• Í∞úÏÑ†: ${detectable.relativePct.toFixed(4)}% (ÏÉÅÎåÄ)<br>
                        Î™©Ìëú(${targetRelative.toFixed(2)}%)Îäî Í≤ÄÏ¶ù Í∞ÄÎä•ÌïòÏßÄÎßå Ïó¨Ïú†Í∞Ä ÌÅ¨ÏßÄ ÏïäÏäµÎãàÎã§.
                    `;
                    return;
                }

                const durationCandidates = [14, 21, 30];
                let suggestions = '';
                for (const days of durationCandidates) {
                    if (days <= formData.duration) {
                        continue;
                    }
                    const futureTotal = Math.round((formData.dailyVisitors * days) / kMeta.k);
                    const futureAvailable = Math.round(futureTotal * (formData.trafficUsagePct / 100));
                    const futureDetectable = calculateDetectableMde(
                        futureAvailable,
                        formData.baselinePct,
                        ratioMeta.ratios[0],
                        ratioMeta.ratios.slice(1),
                        formData.confidencePct,
                        formData.powerPct
                    );
                    if (futureDetectable && futureDetectable.relativePct <= targetRelative) {
                        suggestions += `‚Ä¢ <button type="button" class="chip-btn" onclick="applySuggestedDuration(${days})">${days}ÏùºÎ°ú Ïû¨Í≥ÑÏÇ∞</button> ‚Üí ÏµúÏÜå ${futureDetectable.relativePct.toFixed(4)}%<br>`;
                    }
                }

                comparisonBox.className = 'comparison-box error';
                comparisonBox.innerHTML = `
                    ÌòÑÏû¨ ÏµúÏÜå Í∞êÏßÄ Í∞ÄÎä• Í∞úÏÑ†: ${detectable.relativePct.toFixed(4)}% (ÏÉÅÎåÄ)<br>
                    Î™©Ìëú(${targetRelative.toFixed(2)}%)Îäî ÌòÑÏû¨ ÏÑ§Ï†ïÏóêÏÑú Í≤ÄÏ¶ùÏù¥ Ïñ¥Î†µÏäµÎãàÎã§.<br>
                    <div class="comparison-suggestions">${suggestions || 'Í∂åÏû•: Í∏∞Í∞Ñ Ïó∞Ïû• ÎòêÎäî Ìä∏ÎûòÌîΩ ÏÇ¨Ïö© ÎπÑÏú® ÏÉÅÌñ•ÏùÑ Í≤ÄÌÜ†ÌïòÏÑ∏Ïöî.'}</div>
                `;
            } catch {
                comparisonBox.className = 'comparison-box';
            }
        }

        function displayResults(result, ratioMeta, formData) {
            document.getElementById('result-total-required').textContent = formatNumber(result.requiredTotal) + 'Î™Ö';
            document.getElementById('result-duration').textContent = `${formData.duration}Ïùº`;
            document.getElementById('result-allocation').textContent = ratioMeta.values
                .map((value) => value.toFixed(2).replace(/\.00$/, ''))
                .join(':');

            const slotRangeText = Number.isFinite(result.requiredSlots)
                ? `${formatNumber(result.requiredSlots)}`
                : 'Í≥ÑÏÇ∞ Î∂àÍ∞Ä';
            document.getElementById('result-slot-range').textContent = slotRangeText;

            const slotUsageText = Number.isFinite(result.slotUsagePct)
                ? `Ï†ÑÏ≤¥ Ïä¨Î°ØÏùò ${result.slotUsagePct.toFixed(2)}% (10,000Í∞ú Ï§ë ${formatNumber(result.requiredSlots)}Í∞ú ÌïÑÏöî)`
                : 'Ïä¨Î°Ø ÏÇ¨Ïö©Î•† Í≥ÑÏÇ∞ Î∂àÍ∞Ä';
            document.getElementById('result-slot-percentage').textContent = slotUsageText;

            const formatPctInput = (value) => value.toFixed(4).replace(/\.?0+$/, '');
            const baselineText = `${formatPctInput(formData.baselinePct)}%`;
            const targetValue = formData.mdeMode === 'relative'
                ? formData.baselinePct * (1 + formData.mdeInput / 100)
                : formData.baselinePct + formData.mdeInput;
            const targetText = `${targetValue.toFixed(2)}%`;
            const improvementText = formData.mdeMode === 'relative'
                ? `${formatPctInput(formData.mdeInput)}% (${baselineText} ‚Üí ${targetText})`
                : `${formatPctInput(formData.mdeInput)}%p (${baselineText} ‚Üí ${targetText})`;

            const roundedRatios = ratioMeta.values.map((value) => Math.round(value));
            const allocationText = roundedRatios.length === 2
                ? `ÎåÄÏ°∞Íµ∞(${roundedRatios[0]}%) : Ïã§ÌóòÍµ∞(${roundedRatios[1]}%)`
                : roundedRatios.map((value, idx) => `Í∑∏Î£π${idx + 1}(${value}%)`).join(' : ');

            const detectable = calculateDetectableMde(
                result.availableUsers,
                formData.baselinePct,
                ratioMeta.ratios[0],
                ratioMeta.ratios.slice(1),
                formData.confidencePct,
                formData.powerPct
            );
            const targetRelative = formData.mdeMode === 'relative'
                ? formData.mdeInput
                : (formData.mdeInput / formData.baselinePct) * 100;
            const mdeText = detectable ? `${detectable.relativePct.toFixed(4)}% (ÏÉÅÎåÄ)` : 'Í≥ÑÏÇ∞ Î∂àÍ∞Ä';
            let verdictText = 'Í≥ÑÏÇ∞ Î∂àÍ∞Ä';
            if (detectable) {
                if (targetRelative > detectable.relativePct * 1.5) {
                    verdictText = 'Ï∂©Î∂ÑÌûà Í≤ÄÏ¶ù Í∞ÄÎä•';
                } else if (targetRelative >= detectable.relativePct) {
                    verdictText = 'Í≤ÄÏ¶ù Í∞ÄÎä•ÌïòÏßÄÎßå Ïó¨Ïú†Í∞Ä ÌÅ¨ÏßÄ ÏïäÏùå';
                } else {
                    verdictText = 'ÌòÑÏû¨ Ï°∞Í±¥ÏóêÏÑú Í≤ÄÏ¶ù Ïñ¥Î†§ÏõÄ';
                }
            }
            const slotPctText = Number.isFinite(result.slotUsagePct) ? result.slotUsagePct.toFixed(1) : 'Í≥ÑÏÇ∞ Î∂àÍ∞Ä';
            const slotSummaryText = Number.isFinite(result.requiredSlots) && Number.isFinite(result.slotUsagePct)
                ? `${slotRangeText}Í∞ú (${slotPctText}%)`
                : 'Í≥ÑÏÇ∞ Î∂àÍ∞Ä';
            const reportText =
                `üßæ ÏûÖÎ†• ÏöîÏïΩ\n` +
                `- Ïã§Ìóò Í∏∞Í∞Ñ: ${formData.duration}Ïùº\n` +
                `- ÏùºÌèâÍ∑† Î∞©Î¨∏Ïûê Ïàò: ${formatNumber(formData.dailyVisitors)}Î™Ö\n` +
                `- Ïã§Ìóò ÏÇ¨Ïö© ÎπÑÏú®: ${formData.trafficUsagePct}%\n` +
                `- ÏòàÏÉÅ Í≥†Ïú† Ïú†Ï†Ä Ïàò: ${formatNumber(result.availableUsers)}Î™Ö\n` +
                `- Ïã§Ìóò Í∑∏Î£π Î∞∞Î∂Ñ: ${allocationText}\n\n` +
                `üéØ ÏßÄÌëú Î∞è Í≤ÄÏ¶ù Í∞ÄÎä•ÏÑ±\n` +
                `- Í∏∞Ï§Ä ÏßÄÌëú: ${baselineText}\n` +
                `- Î™©Ìëú Í∞úÏÑ†: ${improvementText}\n` +
                `- ÌòÑÏû¨ ÏµúÏÜå Í∞êÏßÄ Í∞ÄÎä• Í∞úÏÑ†(MDE): ${mdeText}\n` +
                `- ÌåêÏ†ï: ${verdictText}\n\n` +
                `üé∞ ÏÉòÌîå/Ïä¨Î°Ø Í≤∞Í≥º\n` +
                `- Ï¥ù ÌïÑÏöî ÏÉòÌîå Ïàò: ${formatNumber(result.requiredTotal)}Î™Ö\n` +
                `- ÌïÑÏöî Ïä¨Î°Ø Ïàò: ${slotSummaryText}\n` +
                `- Ïä¨Î°Ø ÏÇ¨Ïö©Î•†: ${Number.isFinite(result.slotUsagePct) ? result.slotUsagePct.toFixed(2) + '%' : 'Í≥ÑÏÇ∞ Î∂àÍ∞Ä'}`;

            document.getElementById('result-report').textContent = reportText;
            latestResultSummary = reportText;

            document.getElementById('results').classList.add('show');
            document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function applyEvenRatios() {
            const groupCount = parseInt(document.getElementById('group-count').value, 10);
            const values = getDefaultRatios(groupCount);
            document.getElementById('group-ratios').value = values.join(',');
            updateRatioFeedback();
            updateMdePreview();
            updateMdeComparison();
        }

        window.applySuggestedDuration = function applySuggestedDuration(days) {
            document.getElementById('prop-duration').value = days;
            updateDurationFeedback();
            updateUniqueUsersPreview();
            updateMdePreview();
            updateMdeComparison();
        };

        document.getElementById('advanced-toggle').addEventListener('click', () => {
            const header = document.getElementById('advanced-toggle');
            const content = document.getElementById('advanced-content');
            const isOpen = content.classList.toggle('show');
            header.classList.toggle('open', isOpen);
            header.setAttribute('aria-expanded', String(isOpen));
        });

        document.getElementById('prop-duration').addEventListener('input', () => {
            updateDurationFeedback();
            updateUniqueUsersPreview();
            updateMdePreview();
            updateMdeComparison();
        });

        document.getElementById('prop-daily-visitors').addEventListener('input', () => {
            updateVisitorsFeedback();
            updateUniqueUsersPreview();
            updateMdePreview();
            updateMdeComparison();
        });

        document.getElementById('traffic-usage').addEventListener('input', () => {
            updateUniqueUsersPreview();
            updateMdePreview();
            updateMdeComparison();
        });

        document.getElementById('group-count').addEventListener('change', () => {
            applyEvenRatios();
        });

        document.getElementById('group-ratios').addEventListener('input', () => {
            updateRatioFeedback();
            updateMdePreview();
            updateMdeComparison();
        });

        document.getElementById('apply-even-ratio').addEventListener('click', applyEvenRatios);

        document.getElementById('prop-baseline').addEventListener('input', () => {
            updateMdePreview();
            updateMdeComparison();
        });
        document.getElementById('prop-mde').addEventListener('input', () => {
            document.querySelectorAll('.mde-btn').forEach((btn) => {
                if (btn.dataset.value === document.getElementById('prop-mde').value) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            updateMdeComparison();
        });

        document.getElementById('mde-mode').addEventListener('change', () => {
            updateMdeModeUI();
            updateMdePreview();
            updateMdeComparison();
        });

        document.getElementById('confidence-level').addEventListener('input', () => {
            updateMdePreview();
            updateMdeComparison();
        });

        document.getElementById('power-level').addEventListener('input', () => {
            updateMdePreview();
            updateMdeComparison();
        });

        document.getElementById('calculator-form').addEventListener('submit', (event) => {
            event.preventDefault();

            try {
                const formData = getFormData();
                const ratioMeta = parseGroupRatios(formData.groupRatiosText, formData.groupCount);
                const kMeta = getKValueOrThrow();

                validateFormData(formData, ratioMeta);

                const result = calculateExperiment(formData, ratioMeta, kMeta);
                displayResults(result, ratioMeta, formData);
            } catch (error) {
                alert(error.message);
            }
        });

        document.getElementById('calculator-form').addEventListener('reset', () => {
            setTimeout(() => {
                document.getElementById('results').classList.remove('show');
                document.getElementById('result-report').textContent = '-';
                latestResultSummary = '';
                updateDurationFeedback();
                updateVisitorsFeedback();
                updateMdeModeUI();
                applyEvenRatios();
                updateUniqueUsersPreview();
                updateMdePreview();
                updateMdeComparison();
            }, 0);
        });

        document.getElementById('copy-result-btn').addEventListener('click', async () => {
            if (!latestResultSummary) {
                alert('Î®ºÏ†Ä Í≥ÑÏÇ∞ÏùÑ Ïã§ÌñâÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            try {
                await navigator.clipboard.writeText(latestResultSummary);
                alert('Í≤∞Í≥ºÎ•º Î≥µÏÇ¨ÌñàÏäµÎãàÎã§.');
            } catch {
                alert('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Î∏åÎùºÏö∞Ï†Ä Í∂åÌïúÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
            }
        });

        updateDurationFeedback();
        updateVisitorsFeedback();
        updateMdeModeUI();
        applyEvenRatios();
        updateUniqueUsersPreview();
    </script>
</body>
</html>
