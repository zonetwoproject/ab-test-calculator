<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <title>A/B í…ŒìŠ¤íŠ¸ ê³„ì‚°ê¸° Mark10</title>
    <link rel="icon" type="image/svg+xml" href="/versions/v9/assets/favicon-ab.svg">
    <style>
        :root {
            --bg-page: #f7faff;
            --bg-panel: #ffffff;
            --line: #e3eaf4;
            --text-main: #111827;
            --text-sub: #6b7280;
            --blue-1: #2f83ef;
            --blue-2: #1e64d7;
            --blue-3: #1a5fcf;
            --mint-text: #0f9968;
            --radius-xl: 16px;
            --radius-lg: 14px;
            --radius-md: 12px;
            --card-shadow: 0 2px 8px rgba(36, 80, 149, 0.06);
            --fs-body: 13.5px;
            --fs-title: 22px;
            --fs-version: 12px;
            --fs-label: 12px;
            --fs-step: 14.5px;
            --fs-input: 13.5px;
            --fs-help: 11.5px;
            --fs-unit: 13px;
            --fs-btn: 13.5px;
            --badge-size: 24px;
            --badge-fs: 15px;
            --control-h: 38px;
            --row-gap: 14px;
            --space-1: 4px;
            --space-2: 6px;
            --space-3: 8px;
            --space-4: 10px;
            --space-5: 12px;
            --space-6: 14px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            width: 100%;
            max-width: 100%;
        }

        body {
            font-family: "Pretendard Variable", "Pretendard", "Noto Sans KR", "Apple SD Gothic Neo", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: linear-gradient(180deg, #fbfdff 0%, var(--bg-page) 100%);
            color: var(--text-main);
            min-height: 100vh;
            padding: clamp(8px, 2.5vw, 14px);
            padding-bottom: calc(clamp(12px, 3vw, 18px) + env(safe-area-inset-bottom));
            font-size: var(--fs-body);
            line-height: 1.5;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 860px;
            margin: 0 auto;
            border-radius: 0;
            overflow: visible;
            border: none;
            background: transparent;
            box-shadow: none;
        }

        .header {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 8px 8px 10px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .title-line {
            display: flex;
            align-items: baseline;
            gap: var(--space-2);
        }

        .drag-icon {
            display: none;
        }

        .header h1 {
            font-size: 15px;
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -0.2px;
            color: #111827;
        }

        .version-badge {
            font-size: 10px;
            font-weight: 700;
            line-height: 1.2;
            color: #2f83ef;
            background: #e8f0ff;
            border-radius: 6px;
            padding: 2px 8px;
        }

        .content {
            padding: 0;
            background: transparent;
            width: 100%;
        }

        .content-inner {
            max-width: 100%;
            margin: 0 auto;
            width: 100%;
        }

        .workspace {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .tab-switcher {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: var(--space-2);
            padding: var(--space-2);
            border: 1px solid #d5e1f2;
            border-radius: 14px;
            background: #f3f7ff;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.65);
        }

        .tab-switcher-btn {
            border: 1px solid transparent;
            border-radius: 10px;
            height: calc(var(--control-h) - 6px);
            background: transparent;
            color: #5a6982;
            font-size: var(--fs-btn);
            font-weight: 800;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .tab-switcher-btn.active {
            background: #ffffff;
            color: var(--blue-2);
            border-color: #bed2f7;
            box-shadow: 0 1px 3px rgba(37, 97, 193, 0.12);
        }

        .workspace-grid {
            display: block;
            width: 100%;
        }

        .calculator-pane,
        .guide-pane {
            min-width: 0;
        }

        .guide-pane {
            display: none;
        }

        .content[data-active-tab="guide"] .calculator-pane {
            display: none;
        }

        .content[data-active-tab="guide"] .guide-pane {
            display: block;
        }

        #calculator-form {
            display: flex;
            flex-direction: column;
            gap: clamp(14px, 3.6vw, 22px);
            margin-bottom: var(--space-5);
        }

        .guide-box {
            background: #f5f9ff;
            border: 1px solid #dde7f7;
            border-radius: 14px;
            padding: 12px 14px;
            color: #5d6d86;
            line-height: 1.5;
            font-size: var(--fs-help);
        }

        .guide-box ol {
            margin-left: 15px;
            display: grid;
            gap: var(--space-1);
        }

        .settings-card {
            background: var(--bg-panel);
            border: 1px solid var(--line);
            border-radius: clamp(16px, 4vw, 22px);
            padding: clamp(14px, 4.6vw, 22px) clamp(12px, 4vw, 18px);
            box-shadow: var(--card-shadow);
            max-width: 100%;
        }

        .card-header {
            margin-bottom: 14px;
        }

        .card-title {
            font-size: calc(var(--fs-step) + 6px);
            font-weight: 900;
            color: #1d2433;
            letter-spacing: -0.015em;
            line-height: 1.2;
        }

        .card-subtitle {
            margin-top: 4px;
            font-size: calc(var(--fs-help) + 2px);
            color: #9aa3b2;
            font-weight: 600;
        }

        .step-block {
            padding-bottom: 0;
            border-bottom: none;
        }

        .section-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--row-gap);
            padding-bottom: 0;
            border-bottom: none;
            align-items: start;
        }

        .section-row .form-group {
            margin-bottom: 0;
        }

        .section-row .step-block {
            padding-bottom: 0;
            border-bottom: none;
        }

        .form-group {
            margin-bottom: 8px;
            display: flex;
            flex-direction: column;
            gap: 9px;
            min-width: 0;
        }

        label {
            display: block;
            margin-bottom: 0;
            color: var(--text-main);
            font-size: var(--fs-label);
            font-weight: 700;
        }

        .step-label {
            display: block;
            font-size: var(--fs-step);
            font-weight: 800;
            letter-spacing: -0.005em;
            line-height: 1.35;
            margin-bottom: 0;
        }

        .section-subtitle { display: none; }

        input[type="number"],
        input[type="text"],
        select {
            width: 100%;
            height: clamp(46px, 11vw, 52px);
            border: 1px solid #dfe7f2;
            border-radius: 16px;
            background: #f9fbff;
            color: #1f2937;
            font-size: var(--fs-input);
            padding: 0 clamp(12px, 3.6vw, 14px);
            line-height: 1;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }

        input::placeholder {
            color: #9aa4b5;
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='14' height='8' viewBox='0 0 14 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M2 1.5L7 6L12 1.5' stroke='%236B7280' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            padding-right: 32px;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--blue-3);
            box-shadow: 0 0 0 2px rgba(26, 95, 207, 0.12);
            background: #f8faff;
        }

        .input-with-unit {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .input-with-unit input {
            flex: 1;
        }

        .unit {
            min-width: clamp(24px, 7vw, 30px);
            color: #99a2b2;
            text-align: left;
            font-size: var(--fs-unit);
            font-weight: 700;
        }

        .help-text {
            margin-top: 0;
            font-size: var(--fs-help);
            line-height: 1.42;
            color: var(--text-sub);
            overflow-wrap: anywhere;
        }

        .info-text {
            display: none;
            margin-top: 0;
            border-radius: 14px;
            background: #eef3fc;
            color: #446093;
            padding: 12px 14px;
            font-size: var(--fs-help);
            line-height: 1.42;
            border: 2px solid #bfd5fa;
            font-weight: 700;
            overflow-wrap: anywhere;
        }

        .info-text.show {
            display: block;
        }

        .info-text.error {
            color: #dc2626;
            border-color: #f8b4b4;
            background: #fef2f2;
        }

        .info-text.muted {
            color: #1f8f62;
            border-color: #9de7c5;
            background: #eaf9f1;
        }

        .info-text.primary {
            color: #2e68df;
            border-color: #b5d2ff;
            background: #edf4ff;
        }

        .info-text.warning {
            color: #96620d;
            border-color: #f6d48a;
            background: #fff8e8;
        }

        .highlight-box {
            margin-top: 0;
            border-radius: 14px;
            background: #edf4ff;
            color: #2e68df;
            padding: 12px 14px;
            border: 2px solid #b5d2ff;
            display: none;
            font-size: var(--fs-input);
            line-height: 1.5;
            overflow-wrap: anywhere;
        }

        .preview-meta {
            font-size: var(--fs-help);
            color: #334155;
        }

        .mde-buttons {
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: var(--space-2);
            margin-bottom: 0;
        }

        .mde-btn {
            height: calc(var(--control-h) - 6px);
            border-radius: 6px;
            border: 1px solid #c6cfdb;
            background: #f8fafd;
            color: #334155;
            font-size: var(--fs-input);
            font-weight: 700;
            cursor: pointer;
            transition: border-color 0.15s ease, background-color 0.15s ease;
        }

        .mde-btn:hover {
            border-color: var(--blue-3);
        }

        .mde-btn.active {
            color: #fff;
            border-color: var(--blue-3);
            background: linear-gradient(135deg, var(--blue-1), var(--blue-2));
        }

        .chip-btn {
            border: 1px solid #c6cfdb;
            border-radius: 6px;
            background: #f8fafd;
            color: #3b4454;
            font-size: var(--fs-help);
            font-weight: 700;
            height: calc(var(--control-h) - 10px);
            padding: 0 var(--space-4);
            cursor: pointer;
        }

        .chip-btn:hover {
            border-color: var(--blue-3);
            background: #edf4ff;
        }

        .ratio-feedback-row {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .ratio-feedback-row .chip-btn {
            align-self: flex-start;
        }

        .comparison-box {
            display: none;
            margin-top: 0;
            border-radius: 8px;
            padding: var(--space-3) var(--space-4);
            font-size: var(--fs-input);
            line-height: 1.5;
        }

        .comparison-suggestions {
            margin-top: var(--space-3);
        }

        .comparison-box.success {
            display: block;
            background: #eaf8ef;
            color: #126645;
            border: 1px solid #92d6af;
        }

        .comparison-box.warning {
            display: block;
            background: #fdf7e8;
            color: #946103;
            border: 1px solid #efce84;
        }

        .comparison-box.error {
            display: block;
            background: #fbecee;
            color: #a11f2f;
            border: 1px solid #efb3bc;
        }

        .collapsible {
            border: 1px solid #d6e0ee;
            border-radius: var(--radius-md);
            overflow: hidden;
            background: #ffffff;
        }

        .subsection-divider {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin: 16px 0 10px;
        }

        .subsection-divider::before,
        .subsection-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #cdd5e3;
        }

        .subsection-divider span {
            font-size: var(--fs-label);
            font-weight: 800;
            color: #6a778f;
            letter-spacing: 0.01em;
            white-space: nowrap;
        }

        .collapsible-header {
            background: #ffffff;
            color: #3f4b61;
            font-size: var(--fs-label);
            font-weight: 800;
            padding: var(--space-3) var(--space-4);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 2px solid transparent;
            border-radius: var(--radius-md);
        }

        .collapsible-header.open {
            border-color: #1b63ca;
        }

        .collapsible-content {
            display: none;
            background: transparent;
            border-top: 1px solid #e3e9f2;
            padding: var(--space-3) var(--space-4) 0;
        }

        .collapsible-content.show {
            display: block;
        }

        .collapsible-arrow {
            font-size: var(--fs-label);
            color: #374151;
            transform: rotate(180deg);
            transition: transform 0.2s ease;
        }

        .collapsible-header.open .collapsible-arrow {
            transform: rotate(0deg);
        }

        .inline-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--row-gap);
        }

        .action-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-3);
        }

        .calculate-btn,
        .reset-btn,
        .copy-btn {
            height: var(--control-h);
            border-radius: 6px;
            border: 1px solid transparent;
            font-size: var(--fs-btn);
            font-weight: 800;
            cursor: pointer;
        }

        .calculate-btn {
            color: #fff;
            background: linear-gradient(135deg, var(--blue-1) 0%, var(--blue-2) 100%);
            box-shadow: 0 1px 4px rgba(31, 99, 212, 0.24);
        }

        .calculate-btn:hover {
            filter: brightness(1.03);
        }

        .reset-btn,
        .copy-btn {
            background: #f3f7fd;
            color: #374151;
            border-color: #d9e3f0;
        }

        .copy-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            min-width: 118px;
            padding: 0 var(--space-5);
        }

        .copy-icon {
            width: 14px;
            height: 14px;
            color: #374151;
            fill: currentColor;
            flex-shrink: 0;
        }

        .reset-btn:hover,
        .copy-btn:hover {
            background: #eaf2fb;
        }

        .results {
            margin-top: var(--space-5);
            display: none;
            max-width: 100%;
        }

        .results.show {
            display: block;
        }

        .result-section {
            border-radius: var(--radius-lg);
            border: 1px solid #dfe7f3;
            background: #ffffff;
            box-shadow: var(--card-shadow);
            padding: var(--space-4);
            margin-bottom: var(--space-3);
            max-width: 100%;
            overflow-x: auto;
        }

        .result-hero {
            background: linear-gradient(180deg, #ddf5ea 0%, #d3efe2 100%);
            border: 1px solid #a8d7bf;
            text-align: center;
            padding: calc(var(--space-6) + var(--space-1)) var(--space-4);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.55), 0 1px 6px rgba(16, 120, 84, 0.08);
        }

        .result-section h3 {
            font-size: var(--fs-label);
            font-weight: 800;
            margin-bottom: var(--space-2);
            color: #1f2937;
        }

        .result-hero h3 {
            color: #0f6f4f;
        }

        .result-main {
            font-size: clamp(25px, 6vw, 41px);
            font-weight: 900;
            color: var(--mint-text);
            line-height: 1;
            margin-bottom: var(--space-2);
            letter-spacing: -0.02em;
        }

        .result-label {
            font-size: var(--fs-input);
            color: #5f697b;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 0;
        }

        .result-card {
            border-right: 1px solid #e1e6ee;
            padding: 7px 6px;
            text-align: center;
            background: transparent;
        }

        .result-card:last-child {
            border-right: none;
        }

        .result-card-label {
            font-size: var(--fs-input);
            color: #6b7280;
            margin-bottom: var(--space-1);
        }

        .result-card-value {
            font-size: clamp(15px, 2.4vw, 21px);
            font-weight: 800;
            color: #111827;
            letter-spacing: -0.01em;
        }

        .result-report {
            border: 1px solid #dbe2ee;
            border-radius: 10px;
            background: #ffffff;
            padding: var(--space-4);
            color: #344255;
            font-size: var(--fs-input);
            line-height: 1.65;
            white-space: pre-line;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--fs-input);
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
        }

        .table th,
        .table td {
            border-bottom: 1px solid #e0e4ea;
            padding: var(--space-2) var(--space-3);
            text-align: left;
        }

        .table th {
            font-size: var(--fs-input);
            color: #4b5568;
            background: #eef2f7;
            font-weight: 700;
        }

        .result-actions {
            display: flex;
            justify-content: center;
            margin-top: var(--space-3);
            margin-bottom: var(--space-5);
        }

        .footer {
            text-align: center;
            padding: 0 var(--space-4) calc(var(--space-4) + env(safe-area-inset-bottom));
            color: #64748b;
            font-size: var(--fs-help);
        }

        .guide-panel {
            background: var(--bg-panel);
            border: 1px solid var(--line);
            border-radius: clamp(16px, 4vw, 22px);
            padding: clamp(14px, 4.4vw, 20px) clamp(12px, 4vw, 18px);
            box-shadow: var(--card-shadow);
        }

        .guide-intro-card {
            background: linear-gradient(150deg, #2f83ef 0%, #1c66d8 100%);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: var(--space-4);
        }

        .guide-intro-title {
            font-size: calc(var(--fs-step) + 1px);
            font-weight: 800;
            color: #ffffff;
            margin-bottom: var(--space-2);
        }

        .guide-intro-text {
            font-size: var(--fs-input);
            line-height: 1.58;
            color: rgba(255, 255, 255, 0.9);
        }

        .guide-section-title {
            font-size: calc(var(--fs-step) + 1px);
            font-weight: 800;
            color: #1e293b;
            margin-bottom: var(--space-3);
            margin-top: var(--space-4);
        }

        .guide-section-title:first-of-type {
            margin-top: 0;
        }

        .guide-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
            border: 1px solid #dce5f1;
            border-radius: 12px;
            background: #ffffff;
            padding: 12px;
            margin-bottom: var(--space-2);
        }

        .guide-item-icon {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #edf3ff;
            color: #285ac4;
            flex-shrink: 0;
            font-size: 14px;
        }

        .guide-item-title {
            font-size: var(--fs-input);
            color: #1f2937;
            font-weight: 800;
            margin-bottom: 2px;
            line-height: 1.35;
        }

        .guide-item-desc {
            font-size: var(--fs-help);
            color: #5f6b7e;
            line-height: 1.56;
        }

        .guide-formula-card {
            border: 1px solid #dce5f1;
            border-radius: 12px;
            background: #ffffff;
            padding: 12px;
            margin-bottom: var(--space-2);
        }

        .guide-formula-title {
            font-size: var(--fs-help);
            font-weight: 800;
            color: #2f6fde;
            margin-bottom: var(--space-2);
        }

        .guide-formula-section {
            margin-top: 10px;
        }

        .guide-formula-section:first-of-type {
            margin-top: 0;
        }

        .guide-formula-label {
            font-size: calc(var(--fs-help) - 0.2px);
            font-weight: 800;
            color: #4b5b73;
            margin-bottom: 4px;
        }

        .guide-formula-desc,
        .guide-formula-equation {
            font-size: calc(var(--fs-help) - 0.2px);
            color: #55647b;
            line-height: 1.62;
            white-space: normal;
        }

        .guide-formula-code {
            font-size: calc(var(--fs-help) - 0.2px);
            color: #37465d;
            line-height: 1.62;
            white-space: normal;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            background: #f6f8fc;
            border: 1px solid #e3e8f2;
            border-radius: 8px;
            padding: 8px 10px;
        }

        .guide-note-card {
            border: 1px solid #dce5f1;
            border-radius: 12px;
            background: #ffffff;
            padding: 12px;
        }

        .guide-note-list {
            list-style: none;
            display: grid;
            gap: 4px;
            color: #4b5b73;
            font-size: var(--fs-help);
            line-height: 1.55;
        }

        .guide-note-list li::before {
            content: "â€¢ ";
            color: #2f6fde;
            font-weight: 700;
        }

        .guide-footer {
            margin-top: var(--space-4);
            text-align: center;
            color: #7b879b;
            font-size: calc(var(--fs-help) - 0.2px);
            line-height: 1.45;
        }

        .custom-k-wrap,
        .chip-wrap {
            margin-top: var(--space-3);
        }

        .is-hidden {
            display: none !important;
        }

        .footer a {
            color: var(--blue-3);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .guide-box,
        .content,
        .content-inner,
        .workspace-grid,
        .guide-panel,
        .table,
        .action-row {
            max-width: 100%;
        }

        @media (max-width: 767px) {
            .container {
                border-radius: 10px;
            }

            .header {
                padding: 7px 9px;
            }

            .content {
                padding: 0;
            }

            .tab-switcher {
                gap: 4px;
                padding: 4px;
            }

            .guide-box {
                padding: 10px 12px;
            }

            .settings-card {
                border-radius: 18px;
                padding: 16px 14px;
            }

            .section-row,
            .inline-row {
                grid-template-columns: 1fr;
                gap: var(--row-gap);
            }

            .mde-buttons {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .action-row {
                grid-template-columns: 1fr;
                gap: var(--space-3);
            }

            .result-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }

            .result-card {
                border-right: 1px solid #e1e6ee;
                border-bottom: none;
                padding: 6px 4px;
            }

            .result-card:last-child {
                border-right: none;
            }

            .result-card-label {
                font-size: calc(var(--fs-input) - 1px);
                white-space: nowrap;
            }

            .result-card-value {
                font-size: clamp(12px, 3.2vw, 16px);
            }

            .subsection-divider {
                margin: 14px 0 8px;
            }

            .guide-panel {
                border-radius: 18px;
                padding: 16px 14px;
            }
        }

        @media (max-width: 1024px) {
            .container {
                max-width: 100%;
            }

            .section-row,
            .metric-goal-row,
            .inline-row {
                grid-template-columns: 1fr !important;
            }

            .action-row {
                grid-template-columns: 1fr;
                gap: var(--space-3);
                position: static;
                padding: 0;
                border: 0;
                background: transparent;
                backdrop-filter: none;
            }
        }

        @media (max-width: 420px) {
            .card-title {
                font-size: calc(var(--fs-step) + 4px);
            }

            .step-label {
                line-height: 1.3;
            }

            .mde-btn {
                font-size: calc(var(--fs-input) - 0.5px);
            }
        }

        @media (min-width: 768px) and (max-width: 1199px) {
            :root {
                --fs-body: 14.5px;
                --fs-title: 25px;
                --fs-version: 13px;
                --fs-label: 13px;
                --fs-step: 16px;
                --fs-input: 14px;
                --fs-help: 12px;
                --fs-unit: 14px;
                --fs-btn: 14px;
                --badge-size: 27px;
                --badge-fs: 16px;
                --control-h: 42px;
                --row-gap: 15px;
                --space-1: 4px;
                --space-2: 7px;
                --space-3: 10px;
                --space-4: 12px;
                --space-5: 14px;
                --space-6: 16px;
            }

            body {
                padding: 10px;
            }

            .container {
                max-width: 980px;
            }

            .content {
                padding: var(--space-3) var(--space-4) var(--space-4);
            }

            .section-row,
            .inline-row {
                grid-template-columns: 1fr;
                gap: var(--row-gap);
            }

            .action-row {
                grid-template-columns: 1fr;
                gap: var(--space-3);
            }

            .result-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }

            .result-card {
                border-right: 1px solid #e1e6ee;
                border-bottom: none;
            }

            .result-card:last-child {
                border-right: none;
            }
        }

        @media (min-width: 1200px) {
            :root {
                --fs-body: 15px;
                --fs-title: 27px;
                --fs-version: 13.5px;
                --fs-label: 13.5px;
                --fs-step: 16.5px;
                --fs-input: 14.5px;
                --fs-help: 12.25px;
                --fs-unit: 14.5px;
                --fs-btn: 14.5px;
                --badge-size: 28px;
                --badge-fs: 16.5px;
                --control-h: 43px;
                --row-gap: 16px;
                --space-1: 4px;
                --space-2: 8px;
                --space-3: 10px;
                --space-4: 13px;
                --space-5: 16px;
                --space-6: 18px;
            }

            body {
                padding: 14px;
            }

            .container {
                max-width: 1240px;
            }

            .content {
                padding: var(--space-4) var(--space-5) var(--space-5);
            }

            .content-inner {
                max-width: 1200px;
            }

            .tab-switcher {
                display: none;
            }

            .workspace-grid {
                display: grid;
                grid-template-columns: minmax(0, 7fr) minmax(0, 3fr);
                gap: var(--space-4);
                align-items: start;
            }

            .guide-pane {
                display: block;
                position: sticky;
                top: 14px;
            }

            .guide-panel {
                max-height: calc(100vh - 28px);
                overflow: auto;
            }

            #calculator-form {
                gap: var(--space-4);
            }

            .header {
                padding: 9px 14px;
            }

            .section-row {
                grid-template-columns: repeat(2, minmax(0, 1fr));
                gap: var(--row-gap);
            }

            .paired-steps {
                grid-template-columns: 1.1fr 0.9fr;
            }

            .traffic-row {
                grid-template-columns: 1.05fr 0.95fr;
            }

            .group-row {
                grid-template-columns: 0.95fr 1.05fr;
            }

            .metric-goal-row {
                grid-template-columns: 1.12fr 0.88fr;
            }

            .inline-row {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .action-row {
                grid-template-columns: 1fr 116px;
            }
        }

        @media (max-width: 1199px) {
            .footer {
                padding-bottom: calc(var(--space-4) + env(safe-area-inset-bottom));
            }
        }

        @media (max-height: 520px) and (orientation: landscape) {
            body {
                padding: 8px;
            }

            #calculator-form {
                gap: 12px;
            }

            .guide-box {
                padding: 10px 12px;
            }

            .settings-card {
                padding: 14px;
            }

            .form-group {
                gap: 7px;
                margin-bottom: 6px;
            }

            .section-row.metric-goal-row,
            .inline-row {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .mde-buttons {
                grid-template-columns: repeat(4, minmax(0, 1fr));
            }

            .action-row {
                grid-template-columns: 1fr;
            }

            .result-section {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <span class="drag-icon">â‹®â‹®</span>
                <div class="title-line">
                    <h1>ì‹¤í—˜ ê³„ì‚°ê¸°</h1>
                    <span class="version-badge">Mark10</span>
                </div>
            </div>
        </div>

        <div class="content" data-active-tab="calculator">
            <div class="content-inner">
                <div class="workspace">
                    <div class="tab-switcher" role="tablist" aria-label="ì„œë¹„ìŠ¤ íƒ­">
                        <button type="button" class="tab-switcher-btn active" data-tab="calculator" role="tab" aria-selected="true">ê³„ì‚°ê¸°</button>
                        <button type="button" class="tab-switcher-btn" data-tab="guide" role="tab" aria-selected="false">ì‚¬ìš© ê°€ì´ë“œ</button>
                    </div>
                    <div class="workspace-grid">
                        <div class="calculator-pane">
                            <form id="calculator-form">
                <div class="guide-box">
                    <ol>
                        <li>ë™ì¼ ì§€ë©´ì—ì„œ ì—¬ëŸ¬ ì‹¤í—˜ì„ ì§„í–‰í•  ë•Œ ìƒ˜í”Œì´ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ìŠ¬ë¡¯ì„ ë‚˜ëˆ  ì‚¬ìš©í•˜ì„¸ìš”.</li>
                        <li>ì‹¤í—˜ ê¸°ê°„ê³¼ ë°©ë¬¸ ìˆ˜ë¥¼ ì…ë ¥í•˜ë©´ ê¶Œì¥ ìŠ¬ë¡¯ ìˆ˜ë¥¼ ìë™ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.</li>
                    </ol>
                </div>

                <div class="settings-card">
                    <div class="card-header">
                        <div class="card-title">ê³ ìœ  ìœ ì € ê³„ì‚°í•˜ê¸°</div>
                    </div>

                    <div class="form-group">
                        <label class="step-label" for="prop-duration">ì‹¤í—˜ ê¸°ê°„ì€ ë©°ì¹ ì¸ê°€ìš”?</label>
                        <div class="input-with-unit">
                            <input type="number" id="prop-duration" value="14" min="1" step="1" required>
                            <span class="unit">ì¼</span>
                        </div>
                        <div class="info-text" id="duration-feedback"></div>
                    </div>

                    <div class="form-group">
                        <label class="step-label" for="prop-daily-visitors">í•˜ë£¨ì— ëª‡ ëª…ì´ ë°©ë¬¸í•˜ë‚˜ìš”?</label>
                        <div class="input-with-unit">
                            <input type="number" id="prop-daily-visitors" placeholder="ì˜ˆ: 100000" min="1" step="1" required>
                            <span class="unit">ëª…/ì¼</span>
                        </div>
                        <div class="help-text">ì‹¤í—˜ ë¶„ë°° ë‹¨ìœ„ ê¸°ì¤€, ìµœê·¼ 1ê°œì›” ê¸°ì¤€ ì¼í‰ê·  ë°©ë¬¸ ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”<br>(ì˜ˆ. ë””ë°”ì´ìŠ¤ ê¸°ì¤€ ì‹¤í—˜ì˜ ê²½ìš° device_idì˜ ì¼í‰ê·  ë°©ë¬¸)</div>
                        <div class="info-text" id="visitors-feedback"></div>
                        <div class="highlight-box" id="preview-users"></div>
                    </div>
                </div>

                <div class="settings-card">
                    <div class="card-header">
                        <div class="card-title">ì‹¤í—˜ ê·¸ë£¹ ë°°ë¶„í•˜ê¸°</div>
                    </div>

                    <div class="form-group">
                        <label class="step-label" for="group-count">ì‹¤í—˜ ê·¸ë£¹ ìˆ˜ (ëŒ€ì¡°êµ° í¬í•¨)</label>
                        <select id="group-count">
                            <option value="2" selected>2ê°œ (A/B)</option>
                            <option value="3">3ê°œ (A/B/C)</option>
                            <option value="4">4ê°œ (A/B/C/D)</option>
                            <option value="5">5ê°œ (A/B/C/D/E)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="step-label" for="group-ratios">ë°°ë¶„ ë¹„ìœ¨ì„ ì„ íƒí•˜ì„¸ìš”</label>
                        <input type="text" id="group-ratios" value="50,50" placeholder="ì˜ˆ: 50,30,20">
                        <div class="help-text">ì²« ë²ˆì§¸ ê°’ì€ ëŒ€ì¡°êµ°ì…ë‹ˆë‹¤. ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì„¸ìš”.</div>
                        <div class="ratio-feedback-row">
                            <div class="info-text" id="ratio-feedback"></div>
                            <button type="button" class="chip-btn is-hidden" id="apply-even-ratio-from-input">ì…ë ¥ ê·¸ë£¹ìˆ˜ ê¸°ì¤€ ìë™ ë¶„ë°°</button>
                        </div>
                    </div>
                </div>

                <div class="settings-card">
                    <div class="card-header">
                        <div class="card-title">ìµœì†Œ ê°ì§€ íš¨ê³¼ ê³„ì‚°í•˜ê¸°</div>
                    </div>

                    <div class="section-row metric-goal-row">
                        <div class="form-group">
                            <label class="step-label" for="prop-baseline">ëª©í‘œ ì§€í‘œì˜ í˜„ì¬ ìˆ˜ì¤€ì€ ì–´ë–¤ê°€ìš”?</label>
                            <div class="input-with-unit">
                                <input type="number" id="prop-baseline" placeholder="ì˜ˆ: 3" min="0" max="100" step="0.0001" required>
                                <span class="unit">%</span>
                            </div>
                            <div class="help-text">ëª©í‘œí•˜ëŠ” ì§€í‘œì˜ ìµœê·¼ ì¼í‰ê·  ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (CTR, CVR ë“±)</div>
                            <div class="highlight-box" id="mde-preview"></div>
                        </div>

                        <div class="form-group">
                            <label class="step-label" for="mde-mode">ì´ ì§€í‘œë¥¼ ì–¼ë§ˆë‚˜ ê°œì„ í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?</label>
                            <select id="mde-mode">
                                <option value="relative" selected>ìƒëŒ€ ê°œì„ ìœ¨ (%)</option>
                                <option value="absolute">ì ˆëŒ€ ê°œì„ í­ (%p)</option>
                            </select>

                            <div class="mde-buttons" id="mde-buttons"></div>

                            <div class="input-with-unit">
                                <input type="number" id="prop-mde" placeholder="ì˜ˆ: 5" min="0" step="0.0001" required>
                                <span class="unit" id="mde-unit">%</span>
                            </div>
                            <div class="help-text" id="mde-help">ìƒëŒ€ ê°œì„ ìœ¨ ê¸°ì¤€ìœ¼ë¡œ ëª©í‘œë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>
                            <div class="comparison-box" id="mde-comparison"></div>
                        </div>
                    </div>

                    <div class="subsection-divider">
                        <span>ê³ ê¸‰ ì„¤ì •</span>
                    </div>

                    <div class="collapsible">
                        <div class="collapsible-header" id="advanced-toggle" role="button" aria-expanded="false" aria-controls="advanced-content">
                            <span>âš™ï¸ ê³ ê¸‰ ì„¤ì •</span>
                            <span class="collapsible-arrow" aria-hidden="true">âŒƒ</span>
                        </div>
                        <div class="collapsible-content" id="advanced-content">
                            <div class="inline-row">
                                <div class="form-group">
                                    <label for="confidence-level">ì‹ ë¢°ë„ (Confidence)</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="confidence-level" value="95" min="50" max="99.9" step="0.1">
                                        <span class="unit">%</span>
                                    </div>
                                    <div class="help-text">ì¼ë°˜ì ìœ¼ë¡œ 95%ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤ (ì–‘ì¸¡ ê²€ì •).</div>
                                </div>

                                <div class="form-group">
                                    <label for="power-level">ê²€ì •ë ¥ (Power)</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="power-level" value="80" min="50" max="99.9" step="0.1">
                                        <span class="unit">%</span>
                                    </div>
                                    <div class="help-text">ì¼ë°˜ì ìœ¼ë¡œ 80%ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="action-row">
                    <button type="submit" class="calculate-btn">ğŸ° ìŠ¬ë¡¯ ê³„ì‚°í•˜ê¸°</button>
                    <button type="reset" class="reset-btn" id="reset-form">ì´ˆê¸°í™”</button>
                </div>
            </form>

                            <div class="results" id="results">
                <div class="result-section result-hero">
                    <h3>ğŸ° í•„ìš”í•œ ìŠ¬ë¡¯</h3>
                    <div class="result-main" id="result-slot-range">-</div>
                    <div class="result-label" id="result-slot-percentage">-</div>
                </div>

                <div class="result-section">
                    <div class="result-grid">
                        <div class="result-card">
                            <div class="result-card-label">ì´ í•„ìš” ìƒ˜í”Œ</div>
                            <div class="result-card-value" id="result-total-required">-</div>
                        </div>
                        <div class="result-card">
                            <div class="result-card-label">ì‹¤í—˜ ê¸°ê°„</div>
                            <div class="result-card-value" id="result-duration">-</div>
                        </div>
                        <div class="result-card">
                            <div class="result-card-label">ë°°ë¶„</div>
                            <div class="result-card-value" id="result-allocation">-</div>
                        </div>
                    </div>
                </div>

                <div class="result-section">
                    <h3>ğŸ“ ê³„ì‚° ê²°ê³¼ ë³´ê³ ì„œ</h3>
                    <div class="result-report" id="result-report">-</div>
                </div>

                <div class="result-actions">
                    <button type="button" class="copy-btn" id="copy-result-btn">
                        <svg class="copy-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path d="M8 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V5a3 3 0 0 0-3-3H8zm0 2h10a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1z"></path>
                            <path d="M5 8a1 1 0 0 0-1 1v9a3 3 0 0 0 3 3h9a1 1 0 1 0 0-2H7a1 1 0 0 1-1-1V9a1 1 0 0 0-1-1z"></path>
                        </svg>
                        <span>ê²°ê³¼ ë³µì‚¬</span>
                    </button>
                </div>
                            </div>
                        </div>
                        <aside class="guide-pane" id="guide-pane">
                            <div class="guide-panel" id="guide-panel-content"></div>
                        </aside>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            Built by <a href="mailto:zonetwo.project@gmail.com">zonetwo.project</a> |
            <a href="https://github.com/zonetwoproject/ab-test-calculator" target="_blank">GitHub</a>
        </div>
    </div>

    <script type="module">
        import {
            TOTAL_SLOTS,
            PRESET_MDE,
            formatNumber,
            getDefaultRatios,
            parseGroupRatios,
            calculateDetectableMde,
            validateBaseFormData,
            validateFormData,
            calculateExperiment
        } from '/versions/v9/assets/mark8-core.js';

        const CONFIG = {
            TOTAL_SLOTS,
            PRESET_MDE
        };

        const GUIDE_CONTENT = Object.freeze({
            introTitle: 'ì‹¤í—˜ ê³„ì‚°ê¸°ë€?',
            introText: 'ë™ì¼ ì§€ë©´ì—ì„œ ì—¬ëŸ¬ ì‹¤í—˜ì„ ì§„í–‰í•  ë•Œ ìƒ˜í”Œì´ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ìŠ¬ë¡¯ì„ ë‚˜ëˆ  ì‚¬ìš©í•˜ì„¸ìš”. ì‹¤í—˜ ê¸°ê°„ê³¼ ë°©ë¬¸ ìˆ˜ë¥¼ ì…ë ¥í•˜ë©´ ê¶Œì¥ ìŠ¬ë¡¯ ìˆ˜ë¥¼ ìë™ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.',
            inputItems: [
                {
                    icon: 'ğŸ§ª',
                    title: 'ì‹¤í—˜ ê¸°ê°„ì€ ë©°ì¹ ì¸ê°€ìš”?',
                    description: 'ì‹¤í—˜ ê¸°ê°„ì€ 1ì¼ ì´ìƒ ì…ë ¥í•˜ì„¸ìš”. ìš”ì¼ íš¨ê³¼ë¥¼ ë°˜ì˜í•˜ë ¤ë©´ ìµœì†Œ 7ì¼, ì•ˆì •ì ì¸ ê²°ê³¼ë¥¼ ìœ„í•´ 14ì¼ ì´ìƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.'
                },
                {
                    icon: 'ğŸ¯',
                    title: 'ë°°ë¶„ ë¹„ìœ¨ì„ ì„ íƒí•˜ì„¸ìš”',
                    description: 'ì²« ë²ˆì§¸ ê°’ì€ ëŒ€ì¡°êµ°ì…ë‹ˆë‹¤. ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ê³  í•©ê³„ê°€ 100ì´ ë˜ë„ë¡ ì…ë ¥í•˜ì„¸ìš”.'
                },
                {
                    icon: 'ğŸ“Š',
                    title: 'ëª©í‘œ ì§€í‘œì˜ í˜„ì¬ ìˆ˜ì¤€ì€ ì–´ë–¤ê°€ìš”?',
                    description: 'ëª©í‘œ ì§€í‘œì˜ ìµœê·¼ ì¼í‰ê·  ê°’ì„ ì…ë ¥í•˜ì„¸ìš”. (CTR, CVR ë“±) ì´ ê°’ì´ MDE í”„ë¦¬ë·° ê³„ì‚°ì˜ ê¸°ì¤€ì´ ë©ë‹ˆë‹¤.'
                },
                {
                    icon: 'â„¹ï¸',
                    title: 'ì´ ì§€í‘œë¥¼ ì–¼ë§ˆë‚˜ ê°œì„ í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?',
                    description: 'ìƒëŒ€ ê°œì„ ìœ¨(%) ë˜ëŠ” ì ˆëŒ€ ê°œì„ í­(%p)ìœ¼ë¡œ ëª©í‘œë¥¼ ì…ë ¥í•˜ì„¸ìš”.'
                }
            ],
            formulas: [
                {
                    title: 'ê³ ìœ  ìœ ì € ìˆ˜',
                    description: 'ì¼í‰ê·  ë°©ë¬¸ì ìˆ˜ì™€ ì‹¤í—˜ ê¸°ê°„ì„ ê³±í•´ ì˜ˆìƒ ê³ ìœ  ìœ ì € ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.',
                    equation: 'ì˜ˆìƒ ê³ ìœ  ìœ ì € ìˆ˜ = ë°˜ì˜¬ë¦¼(ì¼í‰ê·  ë°©ë¬¸ì ìˆ˜ Ã— ì‹¤í—˜ ê¸°ê°„)',
                    code: 'totalUniqueUsers = round(dailyVisitors * duration)'
                },
                {
                    title: 'ê°œì„  ëª©í‘œ ë³€í™˜',
                    description: 'ì…ë ¥ ë°©ì‹(ìƒëŒ€/ì ˆëŒ€)ì— ë”°ë¼ ê³„ì‚°ìš© ê°œì„ ìœ¨ì„ í†µì¼í•©ë‹ˆë‹¤.',
                    equation: 'ìƒëŒ€ ê°œì„ ìœ¨ ì…ë ¥ ì‹œ\nê°œì„ ìœ¨ = ì…ë ¥ê°’ / 100\nì‹¤í—˜êµ° ì˜ˆìƒ ì§€í‘œ = í˜„ì¬ ì§€í‘œ Ã— (1 + ê°œì„ ìœ¨)\n\nì ˆëŒ€ ê°œì„ í­(%p) ì…ë ¥ ì‹œ\nì‹¤í—˜êµ° ì˜ˆìƒ ì§€í‘œ = í˜„ì¬ ì§€í‘œ + ì…ë ¥ê°’(%p)\në‚´ë¶€ ê³„ì‚°ìš© ê°œì„ ìœ¨ = ì…ë ¥ê°’ / í˜„ì¬ ì§€í‘œ(%)',
                    code: 'relativeEffect = (relative mode) ? (mdeInput / 100) : (mdeInput / baselinePct)\np2 = p1 * (1 + relativeEffect)\nabsoluteEffectPctPoint = p1 * relativeEffect * 100'
                },
                {
                    title: 'í•„ìš” ìƒ˜í”Œ ìˆ˜ (ë‹¤ì¤‘ ê·¸ë£¹)',
                    description: 'ê° ì‹¤í—˜êµ°ì´ ëŒ€ì¡°êµ°ê³¼ ë¹„êµë  ë•Œ í•„ìš”í•œ ìƒ˜í”Œì„ ê³„ì‚°í•˜ê³ ,\nê·¸ì¤‘ ê°€ì¥ í° ê°’ì„ ì „ì²´ í•„ìš” ìƒ˜í”Œë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.',
                    equation: 'ì‹¤í—˜êµ° iì˜ ë°°ë¶„ë¹„(Îºi) = ì‹¤í—˜êµ° i ë¹„ì¤‘ / ëŒ€ì¡°êµ° ë¹„ì¤‘\nëŒ€ì¡°êµ° í•„ìš” ìƒ˜í”Œ(ni) = (zÎ± + zÎ²)^2 Ã— [ p1(1-p1) + p2(1-p2)/Îºi ] / (p2-p1)^2\ní•´ë‹¹ ì¡°í•© ì´ í•„ìš” ìƒ˜í”Œ = ni / ëŒ€ì¡°êµ° ë¹„ì¤‘\nìµœì¢… ì´ í•„ìš” ìƒ˜í”Œ ìˆ˜ = ì˜¬ë¦¼(ê° ì¡°í•© ì´ í•„ìš” ìƒ˜í”Œ ì¤‘ ìµœëŒ€ê°’)',
                    code: 'kappa_i = treatmentRatio_i / controlRatio\nnControl_i = ((zAlpha + zBeta)^2 * (p1*(1-p1) + p2*(1-p2)/kappa_i)) / (p2 - p1)^2\ntotalForPair_i = nControl_i / controlRatio\nrequiredTotal = ceil(max(totalForPair_i))'
                },
                {
                    title: 'ìŠ¬ë¡¯ ê³„ì‚°',
                    description: 'ì˜ˆìƒ ê³ ìœ  ìœ ì € ìˆ˜ë¥¼ 10,000ê°œ ìŠ¬ë¡¯ ê¸°ì¤€ìœ¼ë¡œ í™˜ì‚°í•´\ní•„ìš”í•œ ìŠ¬ë¡¯ ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.',
                    equation: 'ìŠ¬ë¡¯ë‹¹ ìœ ì € ìˆ˜ = ì˜ˆìƒ ê³ ìœ  ìœ ì € ìˆ˜ / 10,000\ní•„ìš” ìŠ¬ë¡¯ ìˆ˜ = ì˜¬ë¦¼(ì´ í•„ìš” ìƒ˜í”Œ ìˆ˜ / ìŠ¬ë¡¯ë‹¹ ìœ ì € ìˆ˜)\nìŠ¬ë¡¯ ì‚¬ìš©ë¥ (%) = í•„ìš” ìŠ¬ë¡¯ ìˆ˜ / 10,000 Ã— 100',
                    code: 'usersPerSlot = availableUsers / 10000\nrequiredSlots = ceil(requiredTotal / usersPerSlot)\nslotUsagePct = (requiredSlots / 10000) * 100'
                },
                {
                    title: 'MDE ì—­ì‚°',
                    description: 'í˜„ì¬ ì¡°ê±´ì—ì„œ ê²€ì¦ ê°€ëŠ¥í•œ ìµœì†Œ ê°œì„ ìœ¨ì„ ì°¾ê¸° ìœ„í•´,\nê°œì„ ìœ¨ì„ ê°€ì •í•˜ê³  ìƒ˜í”Œ ìˆ˜ë¥¼ ë¹„êµí•˜ë©´ì„œ ë²”ìœ„ë¥¼ ë°˜ë³µì ìœ¼ë¡œ ì¤„ì…ë‹ˆë‹¤.',
                    equation: '1) ê°œì„ ìœ¨ r ê°€ì • â†’ p2 ê³„ì‚°\n2) í•´ë‹¹ rì˜ í•„ìš” ìƒ˜í”Œ ê³„ì‚°\n3) í•„ìš” ìƒ˜í”Œ > ì˜ˆìƒ ê³ ìœ  ìœ ì € ìˆ˜ë©´ r ì¦ê°€\n4) í•„ìš” ìƒ˜í”Œ â‰¤ ì˜ˆìƒ ê³ ìœ  ìœ ì € ìˆ˜ë©´ r ê°ì†Œ\n5) ì´ ê³¼ì •ì„ ë°˜ë³µí•´ ìµœì†Œ r í™•ì • (ìµœëŒ€ 60íšŒ)\n\nìµœì¢… MDE(ìƒëŒ€ %) = r * 100\nìµœì¢… MDE(ì ˆëŒ€ %p) = p1 * r * 100',
                    code: 'low = 0.0001\nhigh = min(3, ((1 - p1) / p1) * 0.999)\nfor up to 60 iterations:\n  mid = (low + high) / 2\n  required = requiredUsers(mid)\n  if required <= availableUsers: high = mid\n  else: low = mid'
                }
            ],
            footerTitle: 'A/B í…ŒìŠ¤íŠ¸ ê³„ì‚°ê¸° Mark10',
            footerSub: 'v10 Â· 2026'
        });

        let latestResultSummary = '';

        function escapeHtml(value) {
            return String(value)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }

        function toMultilineHtml(value) {
            return escapeHtml(value).replace(/\n/g, '<br>');
        }

        function renderGuidePanel() {
            const panel = document.getElementById('guide-panel-content');
            if (!panel) {
                return;
            }

            const itemHtml = GUIDE_CONTENT.inputItems
                .map(({ icon, title, description }) => `
                    <div class="guide-item">
                        <span class="guide-item-icon" aria-hidden="true">${icon}</span>
                        <div class="guide-item-copy">
                            <div class="guide-item-title">${title}</div>
                            <div class="guide-item-desc">${description}</div>
                        </div>
                    </div>
                `)
                .join('');

            const formulaHtml = GUIDE_CONTENT.formulas
                .map(({ title, description, equation, code }) => `
                    <div class="guide-formula-card">
                        <div class="guide-formula-title">${title}</div>
                        <div class="guide-formula-section">
                            <div class="guide-formula-desc">${toMultilineHtml(description)}</div>
                        </div>
                        <div class="guide-formula-section">
                            <div class="guide-formula-equation">${toMultilineHtml(equation)}</div>
                        </div>
                        <div class="guide-formula-section">
                            <div class="guide-formula-label">ê³µì‹(ì½”ë“œ)</div>
                            <div class="guide-formula-code">${toMultilineHtml(code)}</div>
                        </div>
                    </div>
                `)
                .join('');

            panel.innerHTML = `
                <div class="guide-intro-card">
                    <div class="guide-intro-title">${GUIDE_CONTENT.introTitle}</div>
                    <div class="guide-intro-text">${GUIDE_CONTENT.introText}</div>
                </div>

                <div class="guide-section-title">ì…ë ¥ í•­ëª© ì•ˆë‚´</div>
                ${itemHtml}

                <div class="guide-section-title">ê³„ì‚° ê³µì‹</div>
                ${formulaHtml}

                <div class="guide-footer">
                    <div>${GUIDE_CONTENT.footerTitle}</div>
                    <div>${GUIDE_CONTENT.footerSub}</div>
                </div>
            `;
        }

        function setupResponsiveTabs() {
            const content = document.querySelector('.content');
            const buttons = Array.from(document.querySelectorAll('.tab-switcher-btn'));
            const desktopQuery = window.matchMedia('(min-width: 1200px)');

            if (!content || !buttons.length) {
                return;
            }

            const getInitialTab = () => {
                const queryTab = new URLSearchParams(window.location.search).get('tab');
                return queryTab === 'guide' ? 'guide' : 'calculator';
            };

            let currentTab = getInitialTab();

            const applyTabState = (tab, { syncUrl = true } = {}) => {
                currentTab = tab === 'guide' ? 'guide' : 'calculator';
                const activeTab = desktopQuery.matches ? 'desktop' : currentTab;
                content.setAttribute('data-active-tab', activeTab);

                buttons.forEach((button) => {
                    const selected = button.dataset.tab === currentTab;
                    button.classList.toggle('active', selected);
                    button.setAttribute('aria-selected', String(selected));
                    button.tabIndex = selected ? 0 : -1;
                });

                if (syncUrl) {
                    const nextUrl = new URL(window.location.href);
                    if (currentTab === 'guide') {
                        nextUrl.searchParams.set('tab', 'guide');
                    } else {
                        nextUrl.searchParams.delete('tab');
                    }
                    window.history.replaceState({}, '', nextUrl);
                }
            };

            buttons.forEach((button) => {
                button.addEventListener('click', () => applyTabState(button.dataset.tab));
            });

            const onBreakpointChange = () => {
                applyTabState(currentTab, { syncUrl: false });
            };

            if (desktopQuery.addEventListener) {
                desktopQuery.addEventListener('change', onBreakpointChange);
            } else {
                desktopQuery.addListener(onBreakpointChange);
            }

            window.addEventListener('popstate', () => {
                applyTabState(getInitialTab(), { syncUrl: false });
            });

            applyTabState(currentTab, { syncUrl: false });
        }

        function getFormData() {
            return {
                duration: parseInt(document.getElementById('prop-duration').value, 10),
                dailyVisitors: parseFloat(document.getElementById('prop-daily-visitors').value),
                                groupCount: parseInt(document.getElementById('group-count').value, 10),
                groupRatiosText: document.getElementById('group-ratios').value,
                baselinePct: parseFloat(document.getElementById('prop-baseline').value),
                mdeMode: document.getElementById('mde-mode').value,
                mdeInput: parseFloat(document.getElementById('prop-mde').value),
                confidencePct: parseFloat(document.getElementById('confidence-level').value),
                powerPct: parseFloat(document.getElementById('power-level').value)
            };
        }

        function updateDurationFeedback() {
            const days = parseInt(document.getElementById('prop-duration').value, 10);
            const feedback = document.getElementById('duration-feedback');
            feedback.classList.remove('error', 'muted');

            if (!days || days < 1) {
                feedback.classList.add('show');
                feedback.classList.add('error');
                feedback.textContent = 'âŒ 1ì¼ ì´ìƒ ì…ë ¥í•˜ì„¸ìš”.';
                return;
            }

            feedback.classList.add('show');
            feedback.classList.add('muted');
            if (days < 7) {
                feedback.textContent = `ğŸ’¡ ${days}ì¼ì€ 7ì¼ ë¯¸ë§Œìœ¼ë¡œ ìš”ì¼ íš¨ê³¼ê°€ ë‚¨ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
                return;
            }
            if (days < 14) {
                feedback.textContent = `âœ… ${days}ì¼ì€ ê°€ëŠ¥í•˜ì§€ë§Œ, 14ì¼ ì´ìƒì´ ë” ì•ˆì •ì ì…ë‹ˆë‹¤.`;
                return;
            }
            feedback.textContent = `âœ… ${days}ì¼ì€ ìš”ì¼ íš¨ê³¼ë¥¼ ì œê±°í•˜ê¸°ì— ì¶©ë¶„í•œ ê¸°ê°„ì…ë‹ˆë‹¤.`;
        }

        function updateVisitorsFeedback() {
            const visitorInput = document.getElementById('prop-daily-visitors');
            const rawValue = visitorInput.value.trim();
            const visitors = parseFloat(rawValue);
            const feedback = document.getElementById('visitors-feedback');
            feedback.classList.remove('error', 'muted');

            if (!rawValue) {
                feedback.classList.remove('show');
                return;
            }

            if (!Number.isFinite(visitors) || visitors < 1) {
                feedback.classList.add('show');
                feedback.classList.add('error');
                feedback.textContent = 'âŒ 1ëª… ì´ìƒ ì…ë ¥í•˜ì„¸ìš”.';
                return;
            }

            if (visitors < 1000) {
                feedback.classList.add('show');
                feedback.classList.add('muted');
                feedback.textContent = 'ğŸ’¡ íŠ¸ë˜í”½ì´ ë‚®ì•„ ì‹¤í—˜ ê¸°ê°„ì´ ê¸¸ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                return;
            }

            feedback.classList.remove('show');
        }

        function updateUniqueUsersPreview() {
            const previewBox = document.getElementById('preview-users');
            const formData = getFormData();

            if (!formData.duration || !formData.dailyVisitors) {
                previewBox.style.display = 'none';
                return;
            }

            try {
                const totalUniqueUsers = Math.round(formData.dailyVisitors * formData.duration);
                const availableUsers = totalUniqueUsers;

                previewBox.style.display = 'block';
                previewBox.innerHTML = `
                    <strong>ğŸ’¡ ì˜ˆìƒ ê³ ìœ  ìœ ì €: ì•½ ${formatNumber(totalUniqueUsers)}ëª…</strong><br>
                    <span class="preview-meta">
                        ê³„ì‚°: ${formatNumber(formData.dailyVisitors)} Ã— ${formData.duration}ì¼
                    </span>
                `;
            } catch {
                previewBox.style.display = 'none';
            }
        }

        function updateRatioFeedback() {
            const groupCount = parseInt(document.getElementById('group-count').value, 10);
            const feedback = document.getElementById('ratio-feedback');
            const autoBalanceButton = document.getElementById('apply-even-ratio-from-input');
            feedback.classList.remove('error', 'primary');
            try {
                const ratioMeta = parseGroupRatios(document.getElementById('group-ratios').value, groupCount);
                const control = ratioMeta.values[0].toFixed(2).replace(/\.00$/, '');
                const treatments = ratioMeta.values.slice(1).map((v) => v.toFixed(2).replace(/\.00$/, '')).join(' / ');
                feedback.classList.add('show');
                feedback.classList.add('primary');
                feedback.textContent = `ëŒ€ì¡°êµ° ${control}% | ì‹¤í—˜êµ° ${treatments}%`;
                autoBalanceButton.classList.add('is-hidden');
            } catch (error) {
                feedback.classList.add('show');
                feedback.classList.add('error');
                feedback.textContent = error.message;
                const shouldShowAutoBalance = typeof error?.message === 'string'
                    && (error.message.includes('í•©ê³„ëŠ” 100') || error.message.includes('ê·¸ë£¹ ìˆ˜('));
                autoBalanceButton.classList.toggle('is-hidden', !shouldShowAutoBalance);
            }
        }

        function updateMdeModeUI() {
            const mode = document.getElementById('mde-mode').value;
            const unit = document.getElementById('mde-unit');
            const help = document.getElementById('mde-help');
            const input = document.getElementById('prop-mde');
            const buttonWrap = document.getElementById('mde-buttons');
            const values = CONFIG.PRESET_MDE[mode];

            if (mode === 'relative') {
                unit.textContent = '%';
                help.textContent = 'ìƒëŒ€ ê°œì„ ìœ¨ ê¸°ì¤€ìœ¼ë¡œ ëª©í‘œë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
                input.step = '0.0001';
                input.min = '0';
                input.placeholder = 'ì˜ˆ: 5';
            } else {
                unit.textContent = '%p';
                help.textContent = 'ì ˆëŒ€ ê°œì„ í­(%p) ê¸°ì¤€ìœ¼ë¡œ ëª©í‘œë¥¼ ì…ë ¥í•˜ì„¸ìš”. ì˜ˆ: 0.2%p';
                input.step = '0.0001';
                input.min = '0';
                input.placeholder = 'ì˜ˆ: 0.2';
            }

            buttonWrap.innerHTML = values
                .map((value) => {
                    const label = mode === 'relative' ? `+${value}%` : `+${value}%p`;
                    return `<button type="button" class="mde-btn" data-value="${value}">${label}</button>`;
                })
                .join('');

            const currentValue = Number(input.value);
            document.querySelectorAll('.mde-btn').forEach((button) => {
                if (Number(button.dataset.value) === currentValue) {
                    button.classList.add('active');
                }
                button.addEventListener('click', () => {
                    document.getElementById('prop-mde').value = button.dataset.value;
                    document.querySelectorAll('.mde-btn').forEach((btn) => btn.classList.remove('active'));
                    button.classList.add('active');
                    updateMdePreview();
                    updateMdeComparison();
                });
            });
        }

        function getPreviewContext() {
            const formData = getFormData();
            const ratioMeta = parseGroupRatios(formData.groupRatiosText, formData.groupCount);
            validateBaseFormData(formData, ratioMeta);

            const totalUniqueUsers = Math.round(formData.dailyVisitors * formData.duration);
            const availableUsers = totalUniqueUsers;

            return {
                formData,
                ratioMeta,
                totalUniqueUsers,
                availableUsers
            };
        }

        function updateMdePreview() {
            const previewBox = document.getElementById('mde-preview');
            const formData = getFormData();

            if (!Number.isFinite(formData.baselinePct)) {
                previewBox.style.display = 'none';
                return;
            }

            previewBox.style.display = 'block';

            if (formData.baselinePct <= 0 || formData.baselinePct >= 100) {
                previewBox.innerHTML = 'âŒ í˜„ì¬ ì§€í‘œëŠ” 0 ì´ˆê³¼ 100 ë¯¸ë§Œìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                return;
            }

            try {
                const ratioMeta = parseGroupRatios(formData.groupRatiosText, formData.groupCount);
                const hasRequiredContext = Number.isFinite(formData.duration) && formData.duration >= 1
                    && Number.isFinite(formData.dailyVisitors) && formData.dailyVisitors >= 1
                    && Number.isFinite(formData.confidencePct) && formData.confidencePct > 50 && formData.confidencePct < 100
                    && Number.isFinite(formData.powerPct) && formData.powerPct > 50 && formData.powerPct < 100;

                if (!hasRequiredContext) {
                    previewBox.innerHTML = 'ğŸ’¡ í˜„ì¬ ì§€í‘œê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹¤í—˜ ê¸°ê°„/í•˜ë£¨ ë°©ë¬¸ ìˆ˜ë¥¼ ì…ë ¥í•˜ë©´ ìµœì†Œ íš¨ê³¼ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.';
                    return;
                }

                const totalUniqueUsers = Math.round(formData.dailyVisitors * formData.duration);
                const availableUsers = totalUniqueUsers;

                const detectable = calculateDetectableMde(
                    availableUsers,
                    formData.baselinePct,
                    ratioMeta.ratios[0],
                    ratioMeta.ratios.slice(1),
                    formData.confidencePct,
                    formData.powerPct
                );

                if (!detectable) {
                    previewBox.innerHTML = 'âŒ í˜„ì¬ ì…ë ¥ê°’ìœ¼ë¡œ ìµœì†Œ ê°ì§€ íš¨ê³¼ë¥¼ ê³„ì‚°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                    return;
                }

                const newValue = formData.baselinePct + detectable.absolutePctPoint;
                previewBox.innerHTML = `
                    ğŸ¯ í˜„ì¬ ì¡°ê±´ì—ì„œ ê²€ì¦ ê°€ëŠ¥í•œ ìµœì†Œ íš¨ê³¼<br>
                    <strong>ìƒëŒ€ ${detectable.relativePct.toFixed(4)}%</strong> / ì ˆëŒ€ ${detectable.absolutePctPoint.toFixed(3)}%p<br>
                    ê¸°ì¤€ ${formData.baselinePct.toFixed(2)}% â†’ ${newValue.toFixed(2)}%
                `;
            } catch (error) {
                previewBox.innerHTML = `âŒ ${error.message}`;
            }
        }

        function updateMdeComparison() {
            const comparisonBox = document.getElementById('mde-comparison');

            try {
                const { formData, ratioMeta } = getPreviewContext();
                if (!formData.mdeInput || !formData.baselinePct) {
                    comparisonBox.className = 'comparison-box';
                    return;
                }
                validateFormData(formData, ratioMeta);

                const totalUniqueUsers = Math.round(formData.dailyVisitors * formData.duration);
                const availableUsers = totalUniqueUsers;
                const detectable = calculateDetectableMde(
                    availableUsers,
                    formData.baselinePct,
                    ratioMeta.ratios[0],
                    ratioMeta.ratios.slice(1),
                    formData.confidencePct,
                    formData.powerPct
                );

                if (!detectable) {
                    comparisonBox.className = 'comparison-box';
                    return;
                }

                const targetRelative = formData.mdeMode === 'relative'
                    ? formData.mdeInput
                    : (formData.mdeInput / formData.baselinePct) * 100;

                if (!Number.isFinite(targetRelative) || targetRelative <= 0) {
                    comparisonBox.className = 'comparison-box';
                    return;
                }

                if (targetRelative > detectable.relativePct * 1.5) {
                    comparisonBox.className = 'comparison-box success';
                    comparisonBox.innerHTML = `
                        ìµœì†Œ ê°ì§€ ê°€ëŠ¥ ê°œì„ : ${detectable.relativePct.toFixed(4)}% (ìƒëŒ€)<br>
                        ëª©í‘œ(${targetRelative.toFixed(2)}%)ëŠ” ì¶©ë¶„íˆ ê²€ì¦ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                    `;
                    return;
                }

                if (targetRelative >= detectable.relativePct) {
                    comparisonBox.className = 'comparison-box warning';
                    comparisonBox.innerHTML = `
                        ìµœì†Œ ê°ì§€ ê°€ëŠ¥ ê°œì„ : ${detectable.relativePct.toFixed(4)}% (ìƒëŒ€)<br>
                        ëª©í‘œ(${targetRelative.toFixed(2)}%)ëŠ” ê²€ì¦ ê°€ëŠ¥í•˜ì§€ë§Œ ì—¬ìœ ê°€ í¬ì§€ ì•ŠìŠµë‹ˆë‹¤.
                    `;
                    return;
                }

                const durationCandidates = [14, 21, 30];
                let suggestions = '';
                for (const days of durationCandidates) {
                    if (days <= formData.duration) {
                        continue;
                    }
                    const futureTotal = Math.round(formData.dailyVisitors * days);
                    const futureAvailable = futureTotal;
                    const futureDetectable = calculateDetectableMde(
                        futureAvailable,
                        formData.baselinePct,
                        ratioMeta.ratios[0],
                        ratioMeta.ratios.slice(1),
                        formData.confidencePct,
                        formData.powerPct
                    );
                    if (futureDetectable && futureDetectable.relativePct <= targetRelative) {
                        suggestions += `â€¢ <button type="button" class="chip-btn" onclick="applySuggestedDuration(${days})">${days}ì¼ë¡œ ì¬ê³„ì‚°</button> â†’ ìµœì†Œ ${futureDetectable.relativePct.toFixed(4)}%<br>`;
                    }
                }

                comparisonBox.className = 'comparison-box error';
                comparisonBox.innerHTML = `
                    í˜„ì¬ ìµœì†Œ ê°ì§€ ê°€ëŠ¥ ê°œì„ : ${detectable.relativePct.toFixed(4)}% (ìƒëŒ€)<br>
                    ëª©í‘œ(${targetRelative.toFixed(2)}%)ëŠ” í˜„ì¬ ì„¤ì •ì—ì„œ ê²€ì¦ì´ ì–´ë µìŠµë‹ˆë‹¤.<br>
                    <div class="comparison-suggestions">${suggestions || 'ê¶Œì¥: ê¸°ê°„ ì—°ì¥ ë˜ëŠ” ì¼í‰ê·  ë°©ë¬¸ ìˆ˜ ì¦ê°€ë¥¼ ê²€í† í•˜ì„¸ìš”.'}</div>
                `;
            } catch {
                comparisonBox.className = 'comparison-box';
            }
        }

        function displayResults(result, ratioMeta, formData) {
            document.getElementById('result-total-required').textContent = formatNumber(result.requiredTotal) + 'ëª…';
            document.getElementById('result-duration').textContent = `${formData.duration}ì¼`;
            document.getElementById('result-allocation').textContent = ratioMeta.values
                .map((value) => value.toFixed(2).replace(/\.00$/, ''))
                .join(':');

            const slotRangeText = Number.isFinite(result.requiredSlots)
                ? `${formatNumber(result.requiredSlots)}`
                : 'ê³„ì‚° ë¶ˆê°€';
            document.getElementById('result-slot-range').textContent = slotRangeText;

            const slotUsageText = Number.isFinite(result.slotUsagePct)
                ? `ì „ì²´ ìŠ¬ë¡¯ì˜ ${result.slotUsagePct.toFixed(2)}% (10,000ê°œ ì¤‘ ${formatNumber(result.requiredSlots)}ê°œ í•„ìš”)`
                : 'ìŠ¬ë¡¯ ì‚¬ìš©ë¥  ê³„ì‚° ë¶ˆê°€';
            document.getElementById('result-slot-percentage').textContent = slotUsageText;

            const formatPctInput = (value) => value.toFixed(4).replace(/\.?0+$/, '');
            const baselineText = `${formatPctInput(formData.baselinePct)}%`;
            const targetValue = formData.mdeMode === 'relative'
                ? formData.baselinePct * (1 + formData.mdeInput / 100)
                : formData.baselinePct + formData.mdeInput;
            const targetText = `${targetValue.toFixed(2)}%`;
            const improvementText = formData.mdeMode === 'relative'
                ? `${formatPctInput(formData.mdeInput)}% (${baselineText} â†’ ${targetText})`
                : `${formatPctInput(formData.mdeInput)}%p (${baselineText} â†’ ${targetText})`;

            const roundedRatios = ratioMeta.values.map((value) => Math.round(value));
            const allocationText = roundedRatios.length === 2
                ? `ëŒ€ì¡°êµ°(${roundedRatios[0]}%) : ì‹¤í—˜êµ°(${roundedRatios[1]}%)`
                : roundedRatios.map((value, idx) => `ê·¸ë£¹${idx + 1}(${value}%)`).join(' : ');

            const detectable = calculateDetectableMde(
                result.availableUsers,
                formData.baselinePct,
                ratioMeta.ratios[0],
                ratioMeta.ratios.slice(1),
                formData.confidencePct,
                formData.powerPct
            );
            const targetRelative = formData.mdeMode === 'relative'
                ? formData.mdeInput
                : (formData.mdeInput / formData.baselinePct) * 100;
            const mdeText = detectable ? `${detectable.relativePct.toFixed(4)}% (ìƒëŒ€)` : 'ê³„ì‚° ë¶ˆê°€';
            let verdictText = 'ê³„ì‚° ë¶ˆê°€';
            if (detectable) {
                if (targetRelative > detectable.relativePct * 1.5) {
                    verdictText = 'ì¶©ë¶„íˆ ê²€ì¦ ê°€ëŠ¥';
                } else if (targetRelative >= detectable.relativePct) {
                    verdictText = 'ê²€ì¦ ê°€ëŠ¥í•˜ì§€ë§Œ ì—¬ìœ ê°€ í¬ì§€ ì•ŠìŒ';
                } else {
                    verdictText = 'í˜„ì¬ ì¡°ê±´ì—ì„œ ê²€ì¦ ì–´ë ¤ì›€';
                }
            }
            const slotPctText = Number.isFinite(result.slotUsagePct) ? result.slotUsagePct.toFixed(1) : 'ê³„ì‚° ë¶ˆê°€';
            const slotSummaryText = Number.isFinite(result.requiredSlots) && Number.isFinite(result.slotUsagePct)
                ? `${slotRangeText}ê°œ (${slotPctText}%)`
                : 'ê³„ì‚° ë¶ˆê°€';
            const reportText =
                `ğŸ§¾ ì…ë ¥ ìš”ì•½\n` +
                `- ì‹¤í—˜ ê¸°ê°„: ${formData.duration}ì¼\n` +
                `- ì¼í‰ê·  ë°©ë¬¸ì ìˆ˜: ${formatNumber(formData.dailyVisitors)}ëª…\n` +
                `- ì˜ˆìƒ ê³ ìœ  ìœ ì € ìˆ˜: ${formatNumber(result.availableUsers)}ëª…\n` +
                `- ì‹¤í—˜ ê·¸ë£¹ ë°°ë¶„: ${allocationText}\n\n` +
                `ğŸ¯ ì§€í‘œ ë° ê²€ì¦ ê°€ëŠ¥ì„±\n` +
                `- ê¸°ì¤€ ì§€í‘œ: ${baselineText}\n` +
                `- ëª©í‘œ ê°œì„ : ${improvementText}\n` +
                `- í˜„ì¬ ìµœì†Œ ê°ì§€ ê°€ëŠ¥ ê°œì„ (MDE): ${mdeText}\n` +
                `- íŒì •: ${verdictText}\n\n` +
                `ğŸ° ìƒ˜í”Œ/ìŠ¬ë¡¯ ê²°ê³¼\n` +
                `- ì´ í•„ìš” ìƒ˜í”Œ ìˆ˜: ${formatNumber(result.requiredTotal)}ëª…\n` +
                `- í•„ìš” ìŠ¬ë¡¯ ìˆ˜: ${slotSummaryText}\n` +
                `- ìŠ¬ë¡¯ ì‚¬ìš©ë¥ : ${Number.isFinite(result.slotUsagePct) ? result.slotUsagePct.toFixed(2) + '%' : 'ê³„ì‚° ë¶ˆê°€'}`;

            document.getElementById('result-report').textContent = reportText;
            latestResultSummary = reportText;

            document.getElementById('results').classList.add('show');
            document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function applyEvenRatios() {
            const groupCount = parseInt(document.getElementById('group-count').value, 10);
            const values = getDefaultRatios(groupCount);
            document.getElementById('group-ratios').value = values.join(',');
            updateRatioFeedback();
            updateMdePreview();
            updateMdeComparison();
        }

        function getRatioTokenCount() {
            return document.getElementById('group-ratios').value
                .split(/[\s,]+/)
                .map((value) => value.trim())
                .filter(Boolean).length;
        }

        function syncGroupCountFromRatiosInput() {
            const groupCountSelect = document.getElementById('group-count');
            const tokenCount = getRatioTokenCount();

            if (!tokenCount) {
                return;
            }

            const matchedOption = Array.from(groupCountSelect.options).some(
                (option) => Number(option.value) === tokenCount
            );
            if (!matchedOption) {
                return;
            }

            if (parseInt(groupCountSelect.value, 10) !== tokenCount) {
                groupCountSelect.value = String(tokenCount);
            }
        }

        function applyEvenRatiosFromInputTokens() {
            const groupCountSelect = document.getElementById('group-count');
            const tokenCount = getRatioTokenCount();
            const feedback = document.getElementById('ratio-feedback');

            if (!tokenCount) {
                feedback.classList.remove('primary');
                feedback.classList.add('show');
                feedback.classList.add('error');
                feedback.textContent = 'ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ê·¸ë£¹ ë¹„ì¤‘ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.';
                return;
            }

            const matchedOption = Array.from(groupCountSelect.options).some(
                (option) => Number(option.value) === tokenCount
            );

            if (!matchedOption) {
                feedback.classList.remove('primary');
                feedback.classList.add('show');
                feedback.classList.add('error');
                feedback.textContent = `ê·¸ë£¹ ìˆ˜ëŠ” 2~5ê°œê¹Œì§€ë§Œ ì§€ì›í•©ë‹ˆë‹¤. í˜„ì¬ ${tokenCount}ê°œì…ë‹ˆë‹¤.`;
                return;
            }

            groupCountSelect.value = String(tokenCount);
            applyEvenRatios();
        }

        window.applySuggestedDuration = function applySuggestedDuration(days) {
            document.getElementById('prop-duration').value = days;
            updateDurationFeedback();
            updateUniqueUsersPreview();
            updateMdePreview();
            updateMdeComparison();
        };

        document.getElementById('advanced-toggle').addEventListener('click', () => {
            const header = document.getElementById('advanced-toggle');
            const content = document.getElementById('advanced-content');
            const isOpen = content.classList.toggle('show');
            header.classList.toggle('open', isOpen);
            header.setAttribute('aria-expanded', String(isOpen));
        });

        document.getElementById('prop-duration').addEventListener('input', () => {
            updateDurationFeedback();
            updateUniqueUsersPreview();
            updateMdePreview();
            updateMdeComparison();
        });

        document.getElementById('prop-daily-visitors').addEventListener('input', () => {
            updateVisitorsFeedback();
            updateUniqueUsersPreview();
            updateMdePreview();
            updateMdeComparison();
        });

        document.getElementById('group-count').addEventListener('change', () => {
            applyEvenRatios();
        });

        document.getElementById('group-ratios').addEventListener('input', () => {
            syncGroupCountFromRatiosInput();
            updateRatioFeedback();
            updateMdePreview();
            updateMdeComparison();
        });
        document.getElementById('apply-even-ratio-from-input').addEventListener('click', applyEvenRatiosFromInputTokens);

        document.getElementById('prop-baseline').addEventListener('input', () => {
            updateMdePreview();
            updateMdeComparison();
        });
        document.getElementById('prop-mde').addEventListener('input', () => {
            document.querySelectorAll('.mde-btn').forEach((btn) => {
                if (btn.dataset.value === document.getElementById('prop-mde').value) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            updateMdeComparison();
        });

        document.getElementById('mde-mode').addEventListener('change', () => {
            updateMdeModeUI();
            updateMdePreview();
            updateMdeComparison();
        });

        document.getElementById('confidence-level').addEventListener('input', () => {
            updateMdePreview();
            updateMdeComparison();
        });

        document.getElementById('power-level').addEventListener('input', () => {
            updateMdePreview();
            updateMdeComparison();
        });

        document.getElementById('calculator-form').addEventListener('submit', (event) => {
            event.preventDefault();

            try {
                const formData = getFormData();
                const ratioMeta = parseGroupRatios(formData.groupRatiosText, formData.groupCount);

                validateFormData(formData, ratioMeta);

                const result = calculateExperiment(formData, ratioMeta);
                displayResults(result, ratioMeta, formData);
            } catch (error) {
                alert(error.message);
            }
        });

        document.getElementById('calculator-form').addEventListener('reset', () => {
            setTimeout(() => {
                document.getElementById('results').classList.remove('show');
                document.getElementById('result-report').textContent = '-';
                latestResultSummary = '';
                updateDurationFeedback();
                updateVisitorsFeedback();
                updateMdeModeUI();
                applyEvenRatios();
                updateUniqueUsersPreview();
                updateMdePreview();
                updateMdeComparison();
            }, 0);
        });

        document.getElementById('copy-result-btn').addEventListener('click', async () => {
            if (!latestResultSummary) {
                alert('ë¨¼ì € ê³„ì‚°ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
                return;
            }
            try {
                await navigator.clipboard.writeText(latestResultSummary);
                alert('ê²°ê³¼ë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.');
            } catch {
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        });

        renderGuidePanel();
        setupResponsiveTabs();
        updateDurationFeedback();
        updateVisitorsFeedback();
        updateMdeModeUI();
        applyEvenRatios();
        updateUniqueUsersPreview();
        updateMdePreview();
        updateMdeComparison();
    </script>
</body>
</html>
